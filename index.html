<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üé≤ Wenry Dice | Telegram Casino</title>

    <!-- TON Connect Manifest -->
    <meta name="tonconnect-manifest" content="https://smswork34-art.github.io/smswork34-art/tonconnect-manifest.json">
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è TON Connect UI -->
    <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
    
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #ff6b00 0%, #ff9500 100%);
            --dark-bg: #0f0f0f;
            --card-bg: #1a1a1a;
            --surface: #222222;
            --accent: #ff6b00;
            --accent-light: #ff9500;
            --win-color: #00ff88;
            --lose-color: #ff4444;
            --pending-color: #ffaa00;
            --cancelled-color: #888888;
            --text-primary: #ffffff;
            --text-secondary: #aaaaaa;
            --shadow: 0 10px 25px rgba(255, 107, 0, 0.2);
            --border-radius: 16px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
        }

        body {
            background: var(--dark-bg);
            color: var(--text-primary);
            min-height: 100vh;
            padding: 15px;
            padding-bottom: 90px;
            max-width: 500px;
            margin: 0 auto;
        }

        .section {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .header {
            text-align: center;
            margin-bottom: 25px;
            padding-top: 10px;
        }

        .logo {
            font-size: 3rem;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #ff6b00, #ff9500);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            filter: drop-shadow(0 0 15px rgba(255, 107, 0, 0.5));
        }

        .app-title {
            font-size: 2.2rem;
            font-weight: 900;
            letter-spacing: 2px;
            margin-bottom: 5px;
            text-transform: uppercase;
            background: linear-gradient(to right, #ff6b00, #ff9500);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 20px rgba(255, 107, 0, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .dice-icon {
            width: 32px;
            height: 32px;
            fill: #ff6b00;
            filter: drop-shadow(0 0 10px rgba(255, 107, 0, 0.5));
        }

        .app-subtitle {
            color: var(--text-secondary);
            font-size: 0.9rem;
            letter-spacing: 1px;
            text-transform: uppercase;
        }

        .balance-card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(255, 107, 0, 0.2);
            position: relative;
            overflow: hidden;
        }

        .balance-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--primary-gradient);
        }

        .balance-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .balance-amount {
            font-size: 3rem;
            font-weight: 900;
            letter-spacing: 2px;
            color: #ffffff;
            text-shadow: 0 0 15px rgba(255, 107, 0, 0.5);
        }

        .currency {
            font-size: 1.5rem;
            color: var(--accent);
            margin-left: 5px;
            opacity: 0.9;
        }

        .deposit-btn, .withdraw-btn {
            width: 100%;
            padding: 18px;
            background: var(--primary-gradient);
            color: white;
            border: none;
            border-radius: 12px;
            font-weight: 700;
            font-size: 1.1rem;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 5px 15px rgba(255, 107, 0, 0.3);
        }

        .deposit-btn:hover, .withdraw-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(255, 107, 0, 0.4);
        }

        .deposit-btn:active, .withdraw-btn:active {
            transform: translateY(-1px);
        }

        .game-container {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(255, 107, 0, 0.1);
        }

        .section-title {
            font-size: 1.2rem;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--accent);
        }

        .section-title i {
            color: var(--accent);
        }

        .dice-container {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .dice {
            width: 100px;
            height: 100px;
            background: var(--surface);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3.5rem;
            box-shadow: inset 0 0 15px rgba(0,0,0,0.5), 0 10px 25px rgba(0,0,0,0.5);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
            border: 2px solid rgba(255, 107, 0, 0.3);
        }

        .dice::after {
            content: '';
            position: absolute;
            top: -10px;
            left: -10px;
            right: -10px;
            bottom: -10px;
            background: linear-gradient(45deg, transparent 30%, rgba(255,107,0,0.1) 50%, transparent 70%);
            z-index: 1;
        }

        .dice.rolling {
            animation: rollDice 0.8s ease-out;
        }

        @keyframes rollDice {
            0% { transform: rotate(0deg) scale(1); }
            25% { transform: rotate(90deg) scale(1.1); }
            50% { transform: rotate(180deg) scale(1); }
            75% { transform: rotate(270deg) scale(1.1); }
            100% { transform: rotate(360deg) scale(1); }
        }

        .bet-controls {
            background: var(--surface);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 25px;
            border: 1px solid rgba(255, 107, 0, 0.1);
        }

        .bet-amount {
            margin-bottom: 20px;
        }

        .bet-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            color: var(--text-secondary);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .amount-display {
            font-size: 2rem;
            font-weight: 900;
            text-align: center;
            margin: 20px 0;
            color: var(--accent);
            letter-spacing: 1px;
            text-shadow: 0 0 10px rgba(255, 107, 0, 0.3);
        }

        .range-slider {
            width: 100%;
            margin: 25px 0;
            -webkit-appearance: none;
            height: 8px;
            background: rgba(255, 107, 0, 0.1);
            border-radius: 10px;
            outline: none;
        }

        .range-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: var(--accent);
            cursor: pointer;
            box-shadow: 0 0 15px rgba(255, 107, 0, 0.5);
            border: 2px solid #000;
            transition: var(--transition);
        }

        .range-slider::-webkit-slider-thumb:hover {
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(255, 107, 0, 0.7);
        }

        .range-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            color: var(--text-secondary);
            font-size: 0.8rem;
        }

        .amount-controls {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .amount-btn {
            flex: 1;
            padding: 12px;
            background: rgba(255, 107, 0, 0.1);
            border: 2px solid rgba(255, 107, 0, 0.3);
            border-radius: 10px;
            color: var(--accent);
            font-weight: 700;
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.9rem;
            text-transform: uppercase;
        }

        .amount-btn:hover {
            background: rgba(255, 107, 0, 0.2);
            border-color: rgba(255, 107, 0, 0.5);
            transform: translateY(-2px);
        }

        .prediction-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            background: rgba(255, 107, 0, 0.05);
            padding: 20px;
            border-radius: 16px;
            border: 1px solid rgba(255, 107, 0, 0.1);
        }

        .prediction-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            padding: 20px;
            background: var(--surface);
            border-radius: 12px;
            border: 2px solid transparent;
            cursor: pointer;
            transition: var(--transition);
            width: 48%;
        }

        .prediction-btn.active {
            border-color: var(--accent);
            background: rgba(255, 107, 0, 0.1);
            box-shadow: 0 0 20px rgba(255, 107, 0, 0.2);
        }

        .prediction-btn i {
            font-size: 1.8rem;
        }

        .prediction-btn.low i {
            color: var(--lose-color);
        }

        .prediction-btn.high i {
            color: var(--win-color);
        }

        .prediction-btn span {
            font-weight: 700;
            font-size: 1rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .prediction-btn small {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .game-buttons {
            display: flex;
            gap: 15px;
            margin-top: 25px;
        }

        .btn {
            flex: 1;
            padding: 20px;
            border: none;
            border-radius: 12px;
            font-weight: 700;
            font-size: 1.1rem;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn-play {
            background: var(--primary-gradient);
            color: white;
            box-shadow: 0 5px 15px rgba(255, 107, 0, 0.3);
        }

        .btn-play:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(255, 107, 0, 0.4);
        }

        .btn-play:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        .btn-auto {
            background: var(--surface);
            color: var(--text-primary);
            border: 2px solid rgba(255, 107, 0, 0.3);
        }

        .btn-auto:hover {
            border-color: rgba(255, 107, 0, 0.5);
            transform: translateY(-3px);
            background: rgba(255, 107, 0, 0.1);
        }

        .result-message {
            text-align: center;
            padding: 20px;
            margin-top: 25px;
            border-radius: 12px;
            font-weight: 700;
            font-size: 1.2rem;
            display: none;
            border: 2px solid;
            text-transform: uppercase;
            letter-spacing: 1px;
            animation: fadeIn 0.5s ease;
        }

        .win-message {
            background: rgba(0, 255, 136, 0.1);
            color: var(--win-color);
            border-color: var(--win-color);
        }

        .lose-message {
            background: rgba(255, 68, 68, 0.1);
            color: var(--lose-color);
            border-color: var(--lose-color);
        }

        .history-container {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(255, 107, 0, 0.1);
        }

        .history-title {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .history-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
            max-height: 400px;
            overflow-y: auto;
            padding-right: 5px;
        }

        .history-item {
            background: var(--surface);
            border-radius: 12px;
            padding: 18px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: var(--transition);
            border: 1px solid rgba(255, 107, 0, 0.1);
        }

        .history-item:hover {
            transform: translateX(5px);
            border-color: rgba(255, 107, 0, 0.3);
            background: rgba(255, 107, 0, 0.05);
        }

        .history-item.win {
            border-left: 4px solid var(--win-color);
        }

        .history-item.lose {
            border-left: 4px solid var(--lose-color);
        }

        .history-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .history-dice {
            font-size: 2rem;
        }

        .history-details h4 {
            font-size: 1.1rem;
            margin-bottom: 5px;
            font-weight: 700;
        }

        .history-details p {
            color: var(--text-secondary);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .history-amount {
            font-size: 1.3rem;
            font-weight: 900;
            letter-spacing: 1px;
        }

        .history-amount.positive {
            color: var(--win-color);
        }

        .history-amount.negative {
            color: var(--lose-color);
        }

        .bonus-container {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(255, 107, 0, 0.1);
        }

        .profile-container {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(255, 107, 0, 0.1);
        }

        .profile-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
        }

        .profile-avatar {
            width: 80px;
            height: 80px;
            background: var(--primary-gradient);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.2rem;
            border: 3px solid rgba(255, 107, 0, 0.3);
            box-shadow: 0 0 20px rgba(255, 107, 0, 0.3);
        }

        .profile-info h2 {
            font-size: 1.5rem;
            margin-bottom: 5px;
            font-weight: 900;
            background: linear-gradient(to right, #ff6b00, #ff9500);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .profile-info p {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .user-id {
            color: var(--accent) !important;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .user-username {
            color: var(--accent-light) !important;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--surface);
            border-radius: 16px;
            padding: 20px;
            text-align: center;
            border: 1px solid rgba(255, 107, 0, 0.1);
            transition: var(--transition);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            border-color: rgba(255, 107, 0, 0.3);
            box-shadow: 0 10px 20px rgba(255, 107, 0, 0.1);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 900;
            margin-bottom: 5px;
            color: var(--accent);
            text-shadow: 0 0 10px rgba(255, 107, 0, 0.3);
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .profile-actions {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .profile-btn {
            padding: 18px;
            background: var(--surface);
            border: 1px solid rgba(255, 107, 0, 0.1);
            border-radius: 12px;
            color: var(--text-primary);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 1rem;
        }

        .profile-btn:hover {
            background: rgba(255, 107, 0, 0.1);
            transform: translateX(10px);
            border-color: rgba(255, 107, 0, 0.3);
        }

        .profile-btn i {
            width: 24px;
            text-align: center;
            color: var(--accent);
            font-size: 1.2rem;
        }

        /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(15, 15, 15, 0.95);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 30px;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
            transform: translateY(20px);
            transition: transform 0.3s ease;
            border: 2px solid rgba(255, 107, 0, 0.2);
            max-height: 85vh;
            overflow-y: auto;
        }

        .modal-overlay.active .modal {
            transform: translateY(0);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 2px solid rgba(255, 107, 0, 0.1);
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 900;
            display: flex;
            align-items: center;
            gap: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--accent);
        }

        .close-modal {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 1.8rem;
            cursor: pointer;
            transition: var(--transition);
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .close-modal:hover {
            color: var(--accent);
            transform: rotate(90deg);
            background: rgba(255, 107, 0, 0.1);
        }

        .amount-input {
            margin-bottom: 25px;
        }

        .amount-input label {
            display: block;
            margin-bottom: 15px;
            color: var(--text-secondary);
            text-align: center;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 1rem;
        }

        .amount-field {
            position: relative;
        }

        .amount-field input {
            width: 100%;
            padding: 20px;
            background: var(--surface);
            border: 2px solid rgba(255, 107, 0, 0.2);
            border-radius: 12px;
            color: var(--text-primary);
            font-size: 1.5rem;
            font-weight: 900;
            text-align: center;
            transition: var(--transition);
            letter-spacing: 1px;
        }

        .amount-field input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 20px rgba(255, 107, 0, 0.2);
        }

        .amount-field::after {
            content: 'TON';
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--accent);
            font-size: 1.5rem;
            font-weight: 900;
        }

        .amount-suggestions {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 20px;
        }

        .amount-suggestion {
            padding: 15px;
            background: var(--surface);
            border: 2px solid rgba(255, 107, 0, 0.2);
            border-radius: 10px;
            color: var(--text-primary);
            cursor: pointer;
            transition: var(--transition);
            font-weight: 700;
            font-size: 1rem;
            text-align: center;
        }

        .amount-suggestion:hover {
            background: rgba(255, 107, 0, 0.1);
            border-color: rgba(255, 107, 0, 0.5);
            transform: translateY(-3px);
        }

        .payment-details {
            background: var(--surface);
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 25px;
            display: none;
            border: 2px solid rgba(255, 107, 0, 0.2);
        }

        .payment-details.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        .details-title {
            text-align: center;
            margin-bottom: 20px;
            color: var(--accent);
            font-size: 1.1rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 700;
        }

        .details-content {
            background: rgba(255, 107, 0, 0.05);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 107, 0, 0.1);
        }

        .details-item {
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 107, 0, 0.1);
        }

        .details-item:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }

        .details-item .label {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .details-item .value {
            font-weight: 900;
            color: var(--accent);
            font-size: 1.2rem;
            letter-spacing: 1px;
            word-break: break-all;
        }

        .modal-btn {
            width: 100%;
            padding: 20px;
            background: var(--primary-gradient);
            color: white;
            border: none;
            border-radius: 12px;
            font-weight: 700;
            font-size: 1.1rem;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 5px 15px rgba(255, 107, 0, 0.3);
        }

        .modal-btn:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(255, 107, 0, 0.4);
        }

        .modal-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        .modal-btn.secondary {
            background: var(--surface);
            color: var(--text-primary);
            margin-top: 15px;
            border: 2px solid rgba(255, 107, 0, 0.3);
        }

        .modal-btn.secondary:hover:not(:disabled) {
            background: rgba(255, 107, 0, 0.1);
            border-color: rgba(255, 107, 0, 0.5);
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--card-bg);
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.5);
            border-left: 4px solid var(--accent);
            max-width: 350px;
            transform: translateX(400px);
            transition: transform 0.3s ease;
            z-index: 1001;
            border: 2px solid rgba(255, 107, 0, 0.2);
        }

        .notification.active {
            transform: translateX(0);
        }

        .notification.success {
            border-left-color: var(--win-color);
        }

        .notification.error {
            border-left-color: var(--lose-color);
        }

        .notification-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .notification-title {
            font-weight: 700;
            font-size: 1.1rem;
        }

        .notification-message {
            color: var(--text-secondary);
            font-size: 0.95rem;
            line-height: 1.4;
        }

        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--card-bg);
            border-top: 2px solid rgba(255, 107, 0, 0.2);
            padding: 15px;
            display: flex;
            justify-content: space-around;
            max-width: 500px;
            margin: 0 auto;
            z-index: 100;
            backdrop-filter: blur(10px);
        }

        .nav-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            color: var(--text-secondary);
            background: none;
            border: none;
            font-size: 0.8rem;
            cursor: pointer;
            transition: var(--transition);
            padding: 10px;
            border-radius: 12px;
            width: 70px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .nav-btn.active {
            color: var(--accent);
            background: rgba(255, 107, 0, 0.1);
            transform: translateY(-5px);
        }

        .nav-btn i {
            font-size: 1.4rem;
        }

        .loader {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,107,0,.3);
            border-radius: 50%;
            border-top-color: var(--accent);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .payment-method-compact {
            background: var(--surface);
            border: 2px solid transparent;
            border-radius: 12px;
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            transition: var(--transition);
            width: 100%;
            text-align: left;
            margin-bottom: 10px;
        }

        .payment-method-compact.active {
            border-color: var(--accent);
            background: rgba(255, 107, 0, 0.1);
            box-shadow: 0 0 20px rgba(255, 107, 0, 0.2);
        }

        .payment-method-compact:hover {
            transform: translateY(-3px);
            background: rgba(255, 107, 0, 0.1);
            border-color: rgba(255, 107, 0, 0.3);
        }

        .withdraw-input {
            margin-bottom: 25px;
        }

        .withdraw-input label {
            display: block;
            margin-bottom: 10px;
            color: var(--text-secondary);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .withdraw-field {
            width: 100%;
            padding: 18px;
            background: var(--surface);
            border: 2px solid rgba(255, 107, 0, 0.2);
            border-radius: 12px;
            color: var(--text-primary);
            font-size: 1rem;
            transition: var(--transition);
        }

        .withdraw-field:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 20px rgba(255, 107, 0, 0.2);
        }

        .withdraw-method-container {
            margin: 25px 0;
        }

        .withdraw-method-label {
            display: block;
            margin-bottom: 15px;
            color: var(--accent);
            text-align: center;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 1rem;
        }

        /* –ò—Å—Ç–æ—Ä–∏—è –≤—ã–≤–æ–¥–æ–≤ - –£–ü–†–û–©–ï–ù–ù–ê–Ø –í–ï–†–°–ò–Ø */
        .withdraw-history-container {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(255, 107, 0, 0.1);
        }

        .withdraw-history-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
            max-height: 300px;
            overflow-y: auto;
            padding-right: 5px;
        }

        .withdraw-history-item {
            background: var(--surface);
            border-radius: 12px;
            padding: 18px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: var(--transition);
            border: 1px solid transparent;
            border-left: 4px solid var(--accent);
        }

        .withdraw-history-item:hover {
            transform: translateX(5px);
            background: rgba(255, 107, 0, 0.05);
        }

        .withdraw-history-info {
            flex: 1;
        }

        .withdraw-history-info h4 {
            font-size: 1.1rem;
            margin-bottom: 5px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .withdraw-history-details {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .withdraw-history-details p {
            color: var(--text-secondary);
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .withdraw-history-amount {
            font-size: 1.3rem;
            font-weight: 900;
            letter-spacing: 1px;
            color: var(--accent);
        }

        @media (max-width: 480px) {
            .dice {
                width: 80px;
                height: 80px;
                font-size: 2.8rem;
            }
            
            .amount-suggestions {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .notification {
                left: 20px;
                right: 20px;
                max-width: none;
            }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 107, 0, 0.1);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--accent);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--accent-light);
        }

        .bonus-info {
            background: rgba(0, 255, 136, 0.1);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            border: 2px solid rgba(0, 255, 136, 0.3);
        }

        .bonus-title {
            color: var(--win-color);
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 1rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .bonus-description {
            color: var(--text-secondary);
            font-size: 0.85rem;
            line-height: 1.5;
            margin-bottom: 15px;
        }

        .bonus-progress {
            background: var(--surface);
            border-radius: 10px;
            height: 10px;
            margin: 15px 0;
            overflow: hidden;
        }

        .bonus-progress-bar {
            height: 100%;
            background: linear-gradient(to right, #00ff88, #00cc6a);
            border-radius: 10px;
            transition: width 0.3s ease;
        }

        .bonus-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 20px;
        }

        .bonus-stat {
            background: var(--surface);
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            border: 1px solid rgba(255, 107, 0, 0.1);
        }

        .bonus-stat-value {
            font-size: 1.5rem;
            font-weight: 900;
            margin-bottom: 5px;
            color: var(--accent);
        }

        .bonus-stat-label {
            color: var(--text-secondary);
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .bonus-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .bonus-action-btn {
            flex: 1;
            padding: 15px;
            background: linear-gradient(135deg, #00ff88 0%, #00cc6a 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: 700;
            font-size: 0.9rem;
            cursor: pointer;
            transition: var(--transition);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .bonus-action-btn:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 255, 136, 0.3);
        }

        .bonus-action-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        .bonus-action-btn.secondary {
            background: var(--surface);
            color: var(--text-primary);
            border: 2px solid rgba(255, 107, 0, 0.3);
        }

        .bonus-action-btn.secondary:hover:not(:disabled) {
            background: rgba(255, 107, 0, 0.1);
            border-color: rgba(255, 107, 0, 0.5);
        }

        .ton-wallet-input {
            margin: 25px 0;
        }

        .ton-wallet-input label {
            display: block;
            margin-bottom: 10px;
            color: var(--text-secondary);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .ton-wallet-field {
            width: 100%;
            padding: 18px;
            background: var(--surface);
            border: 2px solid rgba(255, 107, 0, 0.2);
            border-radius: 12px;
            color: var(--text-primary);
            font-size: 1rem;
            transition: var(--transition);
            font-family: monospace;
        }

        .ton-wallet-field:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 20px rgba(255, 107, 0, 0.2);
        }

        .ton-payment-btn {
            width: 100%;
            padding: 20px;
            background: linear-gradient(135deg, #0098EA 0%, #0088FF 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-weight: 700;
            font-size: 1.1rem;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 5px 15px rgba(0, 152, 234, 0.3);
        }

        .ton-payment-btn:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0, 152, 234, 0.4);
        }

        .ton-payment-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }
        
        .wallet-connection-status {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 15px;
            background: rgba(0, 152, 234, 0.1);
            border-radius: 10px;
            margin: 10px 0;
            border: 1px solid rgba(0, 152, 234, 0.2);
        }
        
        .wallet-address {
            font-family: monospace;
            font-size: 0.8rem;
            color: #0098EA;
            word-break: break-all;
        }

        /* TON Connect UI —Å—Ç–∏–ª–∏ */
        .ton-connect-button-container {
            margin: 20px 0;
        }

        .ton-connect-button-container .tc_btn {
            width: 100% !important;
            border-radius: 12px !important;
            padding: 16px !important;
            font-size: 1rem !important;
            font-weight: 600 !important;
        }
    </style>
</head>
<body>
    <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
    <div class="notification" id="notification">
        <div class="notification-header">
            <i class="fas fa-check-circle" id="notificationIcon"></i>
            <div class="notification-title" id="notificationTitle">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ</div>
        </div>
        <div class="notification-message" id="notificationMessage"></div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è -->
    <div class="modal-overlay" id="depositModal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title"><i class="fas fa-wallet"></i> –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ</h2>
                <button class="close-modal">&times;</button>
            </div>
            
            <div class="amount-input">
                <label>–°—É–º–º–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è (TON)</label>
                <div class="amount-field">
                    <input type="number" min="1" max="10000" step="1" value="10" id="depositAmount">
                </div>
                <div class="amount-suggestions">
                    <button class="amount-suggestion" data-amount="5">5 TON</button>
                    <button class="amount-suggestion" data-amount="10">10 TON</button>
                    <button class="amount-suggestion" data-amount="20">20 TON</button>
                    <button class="amount-suggestion" data-amount="50">50 TON</button>
                    <button class="amount-suggestion" data-amount="100">100 TON</button>
                    <button class="amount-suggestion" data-amount="200">200 TON</button>
                </div>
            </div>
            
            <div id="walletConnectionStatus" class="wallet-connection-status" style="display: none;">
                <i class="fas fa-wallet" style="color: #0098EA;"></i>
                <div>
                    <div style="font-size: 0.8rem; color: var(--text-secondary);">–ö–æ—à–µ–ª–µ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω:</div>
                    <div class="wallet-address" id="connectedWalletAddress"></div>
                </div>
            </div>
            
            <div class="ton-connect-button-container" id="tonConnectContainer">
                <!-- TON Connect –∫–Ω–æ–ø–∫–∞ –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
            </div>
            
            <div class="payment-details" id="depositDetails" style="display: none;">
                <div style="text-align: center; margin-bottom: 20px;">
                    <div class="details-title">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞</div>
                    <div style="font-size: 1.6rem; font-weight: 900; color: var(--accent); margin-bottom: 20px; letter-spacing: 1px; text-shadow: 0 0 15px rgba(255,107,0,0.3);" id="finalAmount">10 TON</div>
                    
                    <div class="details-content">
                        <div class="details-item">
                            <div class="label">–°—É–º–º–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è:</div>
                            <div class="value" id="depositTonAmount">10 TON</div>
                        </div>
                        <div class="details-item">
                            <div class="label">–ë–æ–Ω—É—Å:</div>
                            <div class="value" id="depositBonus">+0 TON</div>
                        </div>
                        <div class="details-item">
                            <div class="label">–ò—Ç–æ–≥–æ –Ω–∞ –±–∞–ª–∞–Ω—Å:</div>
                            <div class="value" id="depositTotal">10 TON</div>
                        </div>
                    </div>
                    
                    <div style="background: rgba(0,255,136,0.1); border-radius: 12px; padding: 15px; margin: 20px 0; border: 2px solid rgba(0,255,136,0.3);">
                        <div style="font-size: 0.9rem; color: #00ff88; margin-bottom: 10px; font-weight: 700; text-transform: uppercase;">
                            üéÅ –ë–û–ù–£–°!
                        </div>
                        <div style="font-size: 0.8rem; color: #88ffcc; line-height: 1.4;">
                            –ü—Ä–∏ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–∏ 100 TON –≤—ã –ø–æ–ª—É—á–∞–µ—Ç–µ –±–æ–Ω—É—Å +45 TON!<br>
                            –î–ª—è –≤—ã–≤–æ–¥–∞ –±–æ–Ω—É—Å–∞ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –æ—Ç—ã–≥—Ä—ã—à 2x
                        </div>
                    </div>
                </div>
            </div>
            
            <button class="modal-btn" id="depositNextBtn">
                <i class="fas fa-credit-card"></i> –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å
            </button>
            <button class="ton-payment-btn" id="sendPaymentBtn" style="display: none;">
                <i class="fas fa-coins"></i> –û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–ª–∞—Ç–µ–∂
            </button>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—ã–≤–æ–¥–∞ -->
    <div class="modal-overlay" id="withdrawModal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title"><i class="fas fa-credit-card"></i> –í—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤</h2>
                <button class="close-modal">&times;</button>
            </div>
            
            <div class="amount-input">
                <label>–°—É–º–º–∞ –≤—ã–≤–æ–¥–∞ (TON)</label>
                <div class="amount-field">
                    <input type="number" min="1" step="1" value="10" id="withdrawAmount">
                </div>
                <div class="amount-suggestions">
                    <button class="amount-suggestion" data-amount="5">5 TON</button>
                    <button class="amount-suggestion" data-amount="10">10 TON</button>
                    <button class="amount-suggestion" data-amount="20">20 TON</button>
                    <button class="amount-suggestion" data-amount="50">50 TON</button>
                    <button class="amount-suggestion" data-amount="100">100 TON</button>
                    <button class="amount-suggestion" data-amount="200">200 TON</button>
                </div>
            </div>
            
            <div class="withdraw-method-container">
                <label class="withdraw-method-label">
                    –°–ø–æ—Å–æ–± –ø–æ–ª—É—á–µ–Ω–∏—è
                </label>
                <div style="display: flex; flex-direction: column; gap: 10px;">
                    <button class="payment-method-compact active" data-method="ton">
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <div style="width: 45px; height: 45px; background: linear-gradient(135deg, #0098EA 0%, #0088FF 100%); border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; border: 2px solid rgba(0,152,234,0.3);">
                                <i class="fas fa-coins"></i>
                            </div>
                            <div style="text-align: left;">
                                <div style="font-weight: 700; margin-bottom: 3px; font-size: 1rem;">TON</div>
                                <div style="font-size: 0.85rem; color: var(--text-secondary);">–ù–∞ –∫–æ—à–µ–ª–µ–∫ TON</div>
                            </div>
                        </div>
                        <i class="fas fa-check-circle" style="color: var(--accent); font-size: 1.2rem;"></i>
                    </button>
                </div>
            </div>
            
            <div class="ton-wallet-input" id="tonWalletInput">
                <label>–ê–¥—Ä–µ—Å –∫–æ—à–µ–ª—å–∫–∞ TON</label>
                <input type="text" class="ton-wallet-field" id="tonWalletAddress" placeholder="UQB123...abc –∏–ª–∏ EQC123...abc">
            </div>
            
            <div class="payment-details" id="withdrawDetails" style="display: none;">
                <div style="text-align: center; margin-bottom: 20px;">
                    <div class="details-title">–î–µ—Ç–∞–ª–∏ –≤—ã–≤–æ–¥–∞:</div>
                    <div style="font-size: 1.6rem; font-weight: 900; color: var(--accent); margin-bottom: 20px; letter-spacing: 1px; text-shadow: 0 0 15px rgba(255,107,0,0.3);" id="withdrawTotal">10 TON</div>
                    
                    <div class="details-content">
                        <div id="withdrawInfo"></div>
                        <div class="details-item">
                            <div class="label">–ö–æ–º–∏—Å—Å–∏—è:</div>
                            <div class="value" id="withdrawFee">0 TON</div>
                        </div>
                        <div class="details-item">
                            <div class="label">–ö –ø–æ–ª—É—á–µ–Ω–∏—é:</div>
                            <div class="value" id="withdrawNet">10 TON</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <button class="modal-btn" id="withdrawNextBtn">
                <i class="fas fa-arrow-right"></i> –î–∞–ª–µ–µ
            </button>
            <button class="modal-btn secondary" id="withdrawConfirmBtn" style="display: none;">
                <i class="fas fa-check"></i> –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –≤—ã–≤–æ–¥
            </button>
        </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
    <div class="header">
        <div class="logo">üé≤</div>
        <h1 class="app-title">
            <svg class="dice-icon" viewBox="0 0 24 24">
                <path d="M3 5C3 3.89543 3.89543 3 5 3H19C20.1046 3 21 3.89543 21 5V19C21 20.1046 20.1046 21 19 21H5C3.89543 21 3 20.1046 3 19V5Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <circle cx="8.5" cy="8.5" r="1.5" fill="currentColor"/>
                <circle cx="15.5" cy="8.5" r="1.5" fill="currentColor"/>
                <circle cx="8.5" cy="15.5" r="1.5" fill="currentColor"/>
                <circle cx="15.5" cy="15.5" r="1.5" fill="currentColor"/>
                <circle cx="12" cy="12" r="1.5" fill="currentColor"/>
            </svg>
            WENRY DICE
        </h1>
        <p class="app-subtitle" id="userGreeting">Premium Dice Casino</p>
    </div>

    <!-- –°–µ–∫—Ü–∏—è –ò–≥—Ä–∞—Ç—å -->
    <div class="section active" id="playSection">
        <div class="balance-card">
            <div class="balance-label">
                <i class="fas fa-wallet"></i> –í–∞—à –±–∞–ª–∞–Ω—Å
            </div>
            <div class="balance-amount" id="balanceAmount">0<span class="currency"> TON</span></div>
            <button class="deposit-btn" id="depositBtn">
                <i class="fas fa-plus-circle"></i> –ü–æ–ø–æ–ª–Ω–∏—Ç—å
            </button>
            <button class="withdraw-btn" id="withdrawBtnMain">
                <i class="fas fa-credit-card"></i> –í—ã–≤–æ–¥
            </button>
        </div>

        <div class="game-container">
            <h2 class="section-title"><i class="fas fa-dice"></i> –ö–æ—Å—Ç–∏ Wenry</h2>
            
            <div class="dice-container">
                <div class="dice" id="dice1">‚öÑ</div>
                <div class="dice" id="dice2">‚öÉ</div>
            </div>

            <div class="bet-controls">
                <div class="bet-amount">
                    <div class="bet-label">
                        <span>–°—Ç–∞–≤–∫–∞ (TON)</span>
                        <span id="multiplier">–í—ã–∏–≥—Ä—ã—à: x1.8</span>
                    </div>
                    <div class="amount-display" id="betAmount">10 TON</div>
                    <input type="range" min="1" max="100" step="1" value="10" class="range-slider" id="betSlider">
                    <div class="range-labels">
                        <span>1 TON</span>
                        <span>100 TON</span>
                    </div>
                    
                    <div class="amount-controls">
                        <button class="amount-btn" data-action="half">¬Ω</button>
                        <button class="amount-btn" data-action="double">2x</button>
                        <button class="amount-btn" data-action="min">MIN</button>
                        <button class="amount-btn" data-action="max">MAX</button>
                    </div>
                </div>

                <div class="prediction-controls">
                    <button class="prediction-btn low active" id="betLow">
                        <i class="fas fa-arrow-down"></i>
                        <span>–ú–µ–Ω—å—à–µ 7</span>
                        <small>x1.8</small>
                    </button>
                    <button class="prediction-btn high" id="betHigh">
                        <i class="fas fa-arrow-up"></i>
                        <span>–ë–æ–ª—å—à–µ 7</span>
                        <small>x1.8</small>
                    </button>
                </div>
            </div>

            <div class="game-buttons">
                <button class="btn btn-play" id="playButton">
                    <i class="fas fa-play"></i> –ò–≥—Ä–∞—Ç—å
                </button>
                <button class="btn btn-auto" id="autoButton">
                    <i class="fas fa-redo"></i> –ê–≤—Ç–æ
                </button>
            </div>

            <div class="result-message" id="resultMessage"></div>
        </div>
    </div>

    <!-- –°–µ–∫—Ü–∏—è –ò—Å—Ç–æ—Ä–∏—è -->
    <div class="section" id="historySection">
        <div class="balance-card">
            <div class="balance-label">
                <i class="fas fa-wallet"></i> –í–∞—à –±–∞–ª–∞–Ω—Å
            </div>
            <div class="balance-amount" id="balanceAmount2">0<span class="currency"> TON</span></div>
            <button class="deposit-btn" id="depositBtn2">
                <i class="fas fa-plus-circle"></i> –ü–æ–ø–æ–ª–Ω–∏—Ç—å
            </button>
            <button class="withdraw-btn" id="withdrawBtn2">
                <i class="fas fa-credit-card"></i> –í—ã–≤–æ–¥
            </button>
        </div>

        <div class="history-container">
            <div class="history-title">
                <h2 class="section-title"><i class="fas fa-history"></i> –ò—Å—Ç–æ—Ä–∏—è –∏–≥—Ä</h2>
                <button id="clearHistory" style="background:none;border:none;color:var(--text-secondary);cursor:pointer;">
                    <i class="fas fa-trash"></i>
                </button>
            </div>
            <div class="history-list" id="historyList">
                <!-- –ò—Å—Ç–æ—Ä–∏—è –∏–≥—Ä –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
            </div>
        </div>
    </div>

    <!-- –°–µ–∫—Ü–∏—è –ë–æ–Ω—É—Å—ã -->
    <div class="section" id="bonusSection">
        <div class="balance-card">
            <div class="balance-label">
                <i class="fas fa-wallet"></i> –í–∞—à –±–∞–ª–∞–Ω—Å
            </div>
            <div class="balance-amount" id="balanceAmount3">0<span class="currency"> TON</span></div>
            <button class="deposit-btn" id="depositBtn3">
                <i class="fas fa-plus-circle"></i> –ü–æ–ø–æ–ª–Ω–∏—Ç—å
            </button>
            <button class="withdraw-btn" id="withdrawBtn3">
                <i class="fas fa-credit-card"></i> –í—ã–≤–æ–¥
            </button>
        </div>

        <div class="bonus-container">
            <h2 class="section-title"><i class="fas fa-gift"></i> –ë–æ–Ω—É—Å—ã</h2>
            
            <div class="bonus-info">
                <div class="bonus-title">üéÅ –ë–æ–Ω—É—Å –ø—Ä–∏ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–∏</div>
                <div class="bonus-description">
                    –ü—Ä–∏ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–∏ –±–∞–ª–∞–Ω—Å–∞ –Ω–∞ 100 TON –≤—ã –ø–æ–ª—É—á–∞–µ—Ç–µ –±–æ–Ω—É—Å +45 TON!<br>
                    –î–ª—è –≤—ã–≤–æ–¥–∞ –±–æ–Ω—É—Å–∞ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –æ—Ç—ã–≥—Ä—ã—à 2x.
                </div>
                
                <div class="bonus-progress">
                    <div class="bonus-progress-bar" id="bonusProgressBar" style="width: 0%"></div>
                </div>
                
                <div style="text-align: center; color: var(--text-secondary); font-size: 0.8rem; margin: 10px 0;">
                    –ü—Ä–æ–≥—Ä–µ—Å—Å: <span id="bonusProgressText">0/100 TON</span>
                </div>
                
                <div class="bonus-stats">
                    <div class="bonus-stat">
                        <div class="bonus-stat-value" id="bonusAmount">0 TON</div>
                        <div class="bonus-stat-label">–¢–µ–∫—É—â–∏–π –±–æ–Ω—É—Å</div>
                    </div>
                    <div class="bonus-stat">
                        <div class="bonus-stat-value" id="wageringProgress">0x</div>
                        <div class="bonus-stat-label">–û—Ç—ã–≥—Ä—ã—à</div>
                    </div>
                </div>
                
                <div class="bonus-actions">
                    <button class="bonus-action-btn" id="activateBonusBtn" disabled>
                        <i class="fas fa-gift"></i> –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å
                    </button>
                    <button class="bonus-action-btn secondary" id="bonusInfoBtn">
                        <i class="fas fa-info-circle"></i> –ü–æ–¥—Ä–æ–±–Ω–µ–µ
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- –°–µ–∫—Ü–∏—è –ü—Ä–æ—Ñ–∏–ª—å -->
    <div class="section" id="profileSection">
        <div class="balance-card">
            <div class="balance-label">
                <i class="fas fa-wallet"></i> –í–∞—à –±–∞–ª–∞–Ω—Å
            </div>
            <div class="balance-amount" id="balanceAmount4">0<span class="currency"> TON</span></div>
            <button class="deposit-btn" id="depositBtn4">
                <i class="fas fa-plus-circle"></i> –ü–æ–ø–æ–ª–Ω–∏—Ç—å
            </button>
            <button class="withdraw-btn" id="withdrawBtn4">
                <i class="fas fa-credit-card"></i> –í—ã–≤–æ–¥
            </button>
        </div>

        <div class="profile-container">
            <div class="profile-header">
                <div class="profile-avatar" id="userAvatar">
                    <i class="fas fa-user"></i>
                </div>
                <div class="profile-info">
                    <h2 id="userName">–ò–≥—Ä–æ–∫</h2>
                    <p class="user-id" id="userId">ID: ...</p>
                    <p class="user-username" id="userUsername">@username</p>
                    <p id="userLevel" style="color: var(--accent); font-weight: 700;">üé≤ –ù–æ–≤–∏—á–æ–∫</p>
                </div>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="totalWins">0</div>
                    <div class="stat-label">–ü–æ–±–µ–¥</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalGames">0</div>
                    <div class="stat-label">–ò–≥—Ä</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalDeposits">0 TON</div>
                    <div class="stat-label">–ü–æ–ø–æ–ª–Ω–µ–Ω–æ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalWithdrawals">0 TON</div>
                    <div class="stat-label">–í—ã–≤–µ–¥–µ–Ω–æ</div>
                </div>
            </div>

            <div class="withdraw-history-container">
                <h2 class="section-title"><i class="fas fa-exchange-alt"></i> –ò—Å—Ç–æ—Ä–∏—è –≤—ã–≤–æ–¥–æ–≤</h2>
                <div class="withdraw-history-list" id="withdrawHistoryList">
                    <!-- –ò—Å—Ç–æ—Ä–∏—è –≤—ã–≤–æ–¥–æ–≤ –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
                    <div style="text-align: center; padding: 30px 20px; color: var(--text-secondary);">
                        <i class="fas fa-exchange-alt" style="font-size: 2.5rem; margin-bottom: 15px; opacity: 0.5;"></i>
                        <p style="font-size: 0.9rem;">–ò—Å—Ç–æ—Ä–∏—è –≤—ã–≤–æ–¥–æ–≤ –ø—É—Å—Ç–∞</p>
                    </div>
                </div>
            </div>

            <div class="profile-actions">
                <button class="profile-btn" id="statsBtn">
                    <i class="fas fa-chart-line"></i>
                    <span>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</span>
                </button>
                <button class="profile-btn" id="supportBtn">
                    <i class="fas fa-headset"></i>
                    <span>–ü–æ–¥–¥–µ—Ä–∂–∫–∞</span>
                </button>
                <button class="profile-btn" id="logoutBtn">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>–í—ã–π—Ç–∏</span>
                </button>
            </div>
        </div>
    </div>

    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
    <div class="bottom-nav">
        <button class="nav-btn active" data-section="play">
            <i class="fas fa-dice"></i>
            <span>–ò–≥—Ä–∞—Ç—å</span>
        </button>
        <button class="nav-btn" data-section="history">
            <i class="fas fa-history"></i>
            <span>–ò—Å—Ç–æ—Ä–∏—è</span>
        </button>
        <button class="nav-btn" data-section="bonus">
            <i class="fas fa-gift"></i>
            <span>–ë–æ–Ω—É—Å—ã</span>
        </button>
        <button class="nav-btn" data-section="profile">
            <i class="fas fa-user"></i>
            <span>–ü—Ä–æ—Ñ–∏–ª—å</span>
        </button>
    </div>

    <script>
        // ========== –ö–û–ù–°–¢–ê–ù–¢–´ ==========
        const BOT_TOKEN = '8212269748:AAESKhHaV5L5DHjLDYCD6EIZiVhcp1HqMtA';
        const ADMIN_ID = '8155919358';
        const BONUS_THRESHOLD = 100; // TON –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –±–æ–Ω—É—Å–∞
        const BONUS_AMOUNT = 45; // TON –±–æ–Ω—É—Å–∞
        const WAGERING_REQUIREMENT = 2; // 2x –æ—Ç—ã–≥—Ä—ã—à
        const BONUS_EXPIRY_DAYS = 7; // –¥–Ω–µ–π –Ω–∞ –æ—Ç—ã–≥—Ä—ã—à
        
        // –ê–¥—Ä–µ—Å –¥–ª—è –ø—Ä–∏–µ–º–∞ –ø–ª–∞—Ç–µ–∂–µ–π (–ó–ê–ú–ï–ù–ò–¢–ï –ù–ê –°–í–û–ô)
        const RECEIVER_WALLET_ADDRESS = 'UQBKY-FkAwXlWkaZ9bNunXkGO5iChsGLyeTHhjIVthgFXwUh';
        
        let balance = 0;
        let betAmount = 10;
        let isBetLow = true;
        let isAutoPlay = false;
        let gameHistory = [];
        let depositHistory = [];
        let withdrawHistory = [];
        let currentUser = null;
        let currentPaymentId = null;
        let currentWithdrawId = null;
        
        // –ë–æ–Ω—É—Å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞
        let bonusData = {
            availableBonus: 0,
            activeBonus: 0,
            totalDeposited: 0,
            wageringDone: 0,
            wageringRequired: 0,
            bonusActive: false,
            bonusActivatedAt: null,
            bonusExpiresAt: null
        };
        
        const diceFaces = ['‚öÄ', '‚öÅ', '‚öÇ', '‚öÉ', '‚öÑ', '‚öÖ'];
        const MULTIPLIER = 1.8;
        const WIN_CHANCE = 0.4;
        
        // TON Connect
        let tonConnectUI = null;
        let isTonConnected = false;
        let tonAccount = null;
        
        // ========== –≠–õ–ï–ú–ï–ù–¢–´ DOM ==========
        const tg = window.Telegram.WebApp;
        const notification = document.getElementById('notification');
        const notificationTitle = document.getElementById('notificationTitle');
        const notificationMessage = document.getElementById('notificationMessage');
        const notificationIcon = document.getElementById('notificationIcon');
        
        // –ù–∞–≤–∏–≥–∞—Ü–∏—è
        const navButtons = document.querySelectorAll('.nav-btn');
        const sections = {
            play: document.getElementById('playSection'),
            history: document.getElementById('historySection'),
            bonus: document.getElementById('bonusSection'),
            profile: document.getElementById('profileSection')
        };
        
        // –ò–≥—Ä–∞
        const balanceElements = [
            document.getElementById('balanceAmount'),
            document.getElementById('balanceAmount2'),
            document.getElementById('balanceAmount3'),
            document.getElementById('balanceAmount4')
        ];
        const betAmountElement = document.getElementById('betAmount');
        const betSlider = document.getElementById('betSlider');
        const dice1Element = document.getElementById('dice1');
        const dice2Element = document.getElementById('dice2');
        const playButton = document.getElementById('playButton');
        const autoButton = document.getElementById('autoButton');
        const betLowButton = document.getElementById('betLow');
        const betHighButton = document.getElementById('betHigh');
        const resultMessage = document.getElementById('resultMessage');
        const historyList = document.getElementById('historyList');
        const multiplierElement = document.getElementById('multiplier');
        const clearHistoryButton = document.getElementById('clearHistory');
        
        // –ü—Ä–æ—Ñ–∏–ª—å
        const userAvatar = document.getElementById('userAvatar');
        const userName = document.getElementById('userName');
        const userId = document.getElementById('userId');
        const userUsername = document.getElementById('userUsername');
        const userGreeting = document.getElementById('userGreeting');
        const userLevel = document.getElementById('userLevel');
        const totalWins = document.getElementById('totalWins');
        const totalGames = document.getElementById('totalGames');
        const totalDeposits = document.getElementById('totalDeposits');
        const totalWithdrawals = document.getElementById('totalWithdrawals');
        const withdrawHistoryList = document.getElementById('withdrawHistoryList');
        
        // –ë–æ–Ω—É—Å—ã
        const bonusProgressBar = document.getElementById('bonusProgressBar');
        const bonusProgressText = document.getElementById('bonusProgressText');
        const bonusAmount = document.getElementById('bonusAmount');
        const wageringProgress = document.getElementById('wageringProgress');
        const activateBonusBtn = document.getElementById('activateBonusBtn');
        const bonusInfoBtn = document.getElementById('bonusInfoBtn');
        
        // –î–µ–ø–æ–∑–∏—Ç
        const depositModal = document.getElementById('depositModal');
        const depositBtns = document.querySelectorAll('#depositBtn, #depositBtn2, #depositBtn3, #depositBtn4');
        const depositCloseBtn = depositModal.querySelector('.close-modal');
        const depositAmountInput = document.getElementById('depositAmount');
        const finalAmountElement = document.getElementById('finalAmount');
        const depositTonAmount = document.getElementById('depositTonAmount');
        const depositBonus = document.getElementById('depositBonus');
        const depositTotal = document.getElementById('depositTotal');
        const depositNextBtn = document.getElementById('depositNextBtn');
        const sendPaymentBtn = document.getElementById('sendPaymentBtn');
        const tonConnectContainer = document.getElementById('tonConnectContainer');
        const depositDetails = document.getElementById('depositDetails');
        const walletConnectionStatus = document.getElementById('walletConnectionStatus');
        const connectedWalletAddress = document.getElementById('connectedWalletAddress');
        
        // –í—ã–≤–æ–¥
        const withdrawModal = document.getElementById('withdrawModal');
        const withdrawBtns = document.querySelectorAll('#withdrawBtnMain, #withdrawBtn2, #withdrawBtn3, #withdrawBtn4');
        const withdrawCloseBtn = withdrawModal.querySelector('.close-modal');
        const withdrawAmountInput = document.getElementById('withdrawAmount');
        const withdrawTotalElement = document.getElementById('withdrawTotal');
        const withdrawFeeElement = document.getElementById('withdrawFee');
        const withdrawNetElement = document.getElementById('withdrawNet');
        const withdrawInfoElement = document.getElementById('withdrawInfo');
        const withdrawNextBtn = document.getElementById('withdrawNextBtn');
        const withdrawConfirmBtn = document.getElementById('withdrawConfirmBtn');
        const tonWalletInput = document.getElementById('tonWalletInput');
        const tonWalletAddress = document.getElementById('tonWalletAddress');
        const withdrawDetails = document.getElementById('withdrawDetails');
        
        // –û–±—â–∏–µ
        const amountSuggestions = document.querySelectorAll('.amount-suggestion');
        
        // ========== –£–¢–ò–õ–ò–¢–´ ==========
        function showNotification(title, message, type = 'info') {
            notificationTitle.textContent = title;
            notificationMessage.textContent = message;
            
            notification.className = 'notification';
            notificationIcon.className = 'fas ' + 
                (type === 'success' ? 'fa-check-circle' : 
                 type === 'error' ? 'fa-exclamation-circle' : 
                 'fa-info-circle');
            
            if (type === 'success') notification.classList.add('success');
            if (type === 'error') notification.classList.add('error');
            
            notification.classList.add('active');
            
            setTimeout(() => {
                notification.classList.remove('active');
            }, 3000);
        }
        
        function generatePaymentId() {
            return 'WENRY' + Date.now().toString().slice(-8) + Math.floor(Math.random() * 1000).toString().padStart(3, '0');
        }
        
        function generateWithdrawId() {
            return 'WDR' + Date.now().toString().slice(-8) + Math.floor(Math.random() * 1000).toString().padStart(3, '0');
        }
        
        async function sendTelegramMessage(chatId, text, replyMarkup = null) {
            try {
                const url = `https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`;
                const data = {
                    chat_id: chatId,
                    text: text,
                    parse_mode: 'HTML'
                };
                
                if (replyMarkup) {
                    data.reply_markup = replyMarkup;
                }
                
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 5000);
                
                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data),
                    signal: controller.signal
                });
                
                clearTimeout(timeoutId);
                return await response.json();
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ Telegram:', error);
                return null;
            }
        }
        
        function validateTonAddress(address) {
            if (!address) return false;
            const tonRegex = /^(UQ|EQ|0Q)[A-Za-z0-9_-]{48}$/;
            return tonRegex.test(address);
        }
        
        function formatAddress(address) {
            if (!address) return '';
            if (address.length <= 12) return address;
            return address.substring(0, 6) + '...' + address.substring(address.length - 6);
        }
        
        // ========== TON CONNECT –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ==========
        function initTonConnect() {
            try {
                console.log('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è TON Connect...');
                
                const manifestUrl = window.location.origin + '/tonconnect-manifest.json';
                
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –º–∞–Ω–∏—Ñ–µ—Å—Ç URL
                const correctedManifestUrl = 'https://smswork34-art.github.io/smswork34-art/tonconnect-manifest.json';
                
                tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
                    manifestUrl: correctedManifestUrl,
                    buttonRootId: 'tonConnectContainer',
                    actionsConfiguration: {
                        twaReturnUrl: 'https://t.me/DiceCasinoMini_Bot'
                    },
                    uiPreferences: {
                        theme: 'DARK',
                        borderRadius: 's'
                    }
                });
                
                tonConnectUI.onStatusChange(async (walletInfo) => {
                    console.log('–°—Ç–∞—Ç—É—Å –∫–æ—à–µ–ª—å–∫–∞ –∏–∑–º–µ–Ω–µ–Ω:', walletInfo);
                    
                    if (walletInfo) {
                        isTonConnected = true;
                        tonAccount = walletInfo;
                        
                        const shortAddress = formatAddress(tonAccount.account.address);
                        connectedWalletAddress.textContent = shortAddress;
                        walletConnectionStatus.style.display = 'flex';
                        
                        showNotification('–£—Å–ø–µ—à–Ω–æ!', '–ö–æ—à–µ–ª–µ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω', 'success');
                        
                        // –ï—Å–ª–∏ –æ—Ç–∫—Ä—ã—Ç–æ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–µ–ø–æ–∑–∏—Ç–∞, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –æ—Ç–ø—Ä–∞–≤–∫–∏
                        if (depositModal.classList.contains('active')) {
                            updateDepositModalForConnectedWallet();
                        }
                    } else {
                        isTonConnected = false;
                        tonAccount = null;
                        walletConnectionStatus.style.display = 'none';
                        showNotification('–û—Ç–∫–ª—é—á–µ–Ω–æ', '–ö–æ—à–µ–ª–µ–∫ –æ—Ç–∫–ª—é—á–µ–Ω', 'info');
                        
                        if (depositModal.classList.contains('active')) {
                            updateDepositModalForDisconnectedWallet();
                        }
                    }
                });
                
                console.log('TON Connect –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
                return tonConnectUI;
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ TON Connect:', error);
                showNotification('–û—à–∏–±–∫–∞', '–ù–µ —É–¥–∞–ª–æ—Å—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∫–æ—à–µ–ª–µ–∫', 'error');
                return null;
            }
        }
        
        function updateDepositModalForConnectedWallet() {
            depositNextBtn.style.display = 'none';
            sendPaymentBtn.style.display = 'flex';
            sendPaymentBtn.disabled = false;
            sendPaymentBtn.innerHTML = `<i class="fas fa-coins"></i> –û—Ç–ø—Ä–∞–≤–∏—Ç—å ${depositAmountInput.value} TON`;
            depositDetails.style.display = 'block';
        }
        
        function updateDepositModalForDisconnectedWallet() {
            depositNextBtn.style.display = 'flex';
            sendPaymentBtn.style.display = 'none';
            depositDetails.style.display = 'none';
        }
        
        async function sendTonTransaction(amount) {
            try {
                if (!tonConnectUI || !tonAccount) {
                    showNotification('–û—à–∏–±–∫–∞', '–ö–æ—à–µ–ª–µ–∫ –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω', 'error');
                    return false;
                }
                
                const transaction = {
                    validUntil: Math.floor(Date.now() / 1000) + 300,
                    messages: [
                        {
                            address: RECEIVER_WALLET_ADDRESS,
                            amount: (amount * 1000000000).toString()
                        }
                    ]
                };
                
                console.log('–û—Ç–ø—Ä–∞–≤–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏:', transaction);
                
                sendPaymentBtn.disabled = true;
                sendPaymentBtn.innerHTML = '<div class="loader"></div> –û—Ç–ø—Ä–∞–≤–∫–∞...';
                
                const result = await tonConnectUI.sendTransaction(transaction);
                console.log('–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞:', result);
                
                return true;
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏:', error);
                
                sendPaymentBtn.disabled = false;
                sendPaymentBtn.innerHTML = `<i class="fas fa-coins"></i> –û—Ç–ø—Ä–∞–≤–∏—Ç—å ${depositAmountInput.value} TON`;
                
                if (error.message && error.message.includes('User rejected')) {
                    showNotification('–û—Ç–º–µ–Ω–µ–Ω–æ', '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫–ª–æ–Ω–∏–ª —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é', 'error');
                } else {
                    showNotification('–û—à–∏–±–∫–∞', '–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é', 'error');
                }
                return false;
            }
        }
        
        // ========== –û–ë–ù–û–í–õ–ï–ù–ò–ï –î–ê–ù–ù–´–• ==========
        function updateBalance() {
            const formattedBalance = balance.toLocaleString('ru-RU');
            balanceElements.forEach(el => {
                if (el) el.innerHTML = formattedBalance + '<span class="currency"> TON</span>';
            });
            localStorage.setItem('wenry_balance', balance.toString());
            updateWithdrawHistory();
            updateStats();
            updateBonusUI();
        }
        
        function updateBetAmount() {
            betAmountElement.textContent = betAmount + ' TON';
            betSlider.value = betAmount;
        }
        
        function updateBonusUI() {
            const progressPercent = Math.min((bonusData.totalDeposited / BONUS_THRESHOLD) * 100, 100);
            bonusProgressBar.style.width = progressPercent + '%';
            bonusProgressText.textContent = `${bonusData.totalDeposited}/${BONUS_THRESHOLD} TON`;
            
            const totalAvailableBonus = bonusData.availableBonus + bonusData.activeBonus;
            bonusAmount.textContent = totalAvailableBonus + ' TON';
            
            if (bonusData.bonusActive) {
                const wageringPercent = (bonusData.wageringDone / bonusData.wageringRequired) * 100;
                wageringProgress.textContent = `${bonusData.wageringDone.toFixed(1)}x`;
                
                activateBonusBtn.disabled = true;
                activateBonusBtn.innerHTML = '<i class="fas fa-gift"></i> –ë–æ–Ω—É—Å –∞–∫—Ç–∏–≤–µ–Ω';
                
                if (bonusData.bonusExpiresAt && new Date() > bonusData.bonusExpiresAt) {
                    bonusData.bonusActive = false;
                    bonusData.activeBonus = 0;
                    showNotification('–ë–æ–Ω—É—Å –∏—Å—Ç–µ–∫', '–°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è –±–æ–Ω—É—Å–∞ –∏—Å—Ç–µ–∫', 'error');
                    updateBonusUI();
                }
            } else {
                wageringProgress.textContent = '0x';
                
                if (bonusData.availableBonus > 0) {
                    activateBonusBtn.disabled = false;
                    activateBonusBtn.innerHTML = `<i class="fas fa-gift"></i> –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å ${bonusData.availableBonus} TON`;
                } else {
                    activateBonusBtn.disabled = true;
                    activateBonusBtn.innerHTML = '<i class="fas fa-gift"></i> –ù–µ—Ç –±–æ–Ω—É—Å–æ–≤';
                }
            }
            
            saveBonusData();
        }
        
        function addDepositToBonus(amount) {
            bonusData.totalDeposited += amount;
            
            if (bonusData.totalDeposited >= BONUS_THRESHOLD && !bonusData.bonusActive) {
                bonusData.totalDeposited = 0;
                bonusData.availableBonus += BONUS_AMOUNT;
                showNotification('üéÅ –ë–æ–Ω—É—Å –¥–æ—Å—Ç—É–ø–µ–Ω!', `–í—ã –ø–æ–ª—É—á–∏–ª–∏ –±–æ–Ω—É—Å +${BONUS_AMOUNT} TON! –ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ –µ–≥–æ –≤ —Ä–∞–∑–¥–µ–ª–µ "–ë–æ–Ω—É—Å—ã"`, 'success');
            }
            
            updateBonusUI();
        }
        
        function activateBonus() {
            if (bonusData.availableBonus > 0 && !bonusData.bonusActive) {
                bonusData.activeBonus = bonusData.availableBonus;
                bonusData.availableBonus = 0;
                bonusData.bonusActive = true;
                bonusData.wageringRequired = bonusData.activeBonus * WAGERING_REQUIREMENT;
                bonusData.wageringDone = 0;
                bonusData.bonusActivatedAt = new Date();
                
                const expiryDate = new Date();
                expiryDate.setDate(expiryDate.getDate() + BONUS_EXPIRY_DAYS);
                bonusData.bonusExpiresAt = expiryDate;
                
                showNotification('–ë–æ–Ω—É—Å –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω!', `–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω –±–æ–Ω—É—Å ${bonusData.activeBonus} TON. –°–¥–µ–ª–∞–π—Ç–µ –æ—Ç—ã–≥—Ä—ã—à ${WAGERING_REQUIREMENT}x –¥–ª—è –≤—ã–≤–æ–¥–∞`, 'success');
                updateBonusUI();
            }
        }
        
        function updateWagering(betAmount, winAmount) {
            if (bonusData.bonusActive && bonusData.activeBonus > 0) {
                bonusData.wageringDone += betAmount;
                
                if (winAmount > 0) {
                    bonusData.wageringDone += winAmount;
                }
                
                if (bonusData.wageringDone >= bonusData.wageringRequired) {
                    bonusData.bonusActive = false;
                    bonusData.activeBonus = 0;
                    bonusData.wageringDone = 0;
                    bonusData.wageringRequired = 0;
                    showNotification('üéâ –ë–æ–Ω—É—Å –æ—Ç—ã–≥—Ä–∞–Ω!', '–¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –≤—ã–≤–µ—Å—Ç–∏ –±–æ–Ω—É—Å–Ω—ã–µ —Å—Ä–µ–¥—Å—Ç–≤–∞', 'success');
                }
                
                updateBonusUI();
            }
        }
        
        // ========== –ò–ì–†–ê ==========
        function rollDice() {
            const dice1 = Math.floor(Math.random() * 6) + 1;
            const dice2 = Math.floor(Math.random() * 6) + 1;
            const total = dice1 + dice2;
            
            dice1Element.classList.add('rolling');
            dice2Element.classList.add('rolling');
            
            let rolls = 0;
            const rollInterval = setInterval(() => {
                dice1Element.textContent = diceFaces[Math.floor(Math.random() * 6)];
                dice2Element.textContent = diceFaces[Math.floor(Math.random() * 6)];
                rolls++;
                
                if (rolls > 10) {
                    clearInterval(rollInterval);
                    dice1Element.classList.remove('rolling');
                    dice2Element.classList.remove('rolling');
                    
                    dice1Element.textContent = diceFaces[dice1 - 1];
                    dice2Element.textContent = diceFaces[dice2 - 1];
                    
                    checkResult(dice1, dice2, total);
                }
            }, 80);
            
            return { dice1, dice2, total };
        }
        
        function checkResult(dice1, dice2, total) {
            const isWin = Math.random() < WIN_CHANCE;
            
            let actualWin = false;
            if (isWin) {
                if (isBetLow && total < 7) {
                    actualWin = true;
                } else if (!isBetLow && total > 7) {
                    actualWin = true;
                }
            }
            
            const winAmount = actualWin ? Math.round(betAmount * MULTIPLIER) : 0;
            
            if (actualWin) {
                balance += winAmount;
                resultMessage.textContent = `–ü–û–ë–ï–î–ê! +${winAmount} TON (${dice1}+${dice2}=${total})`;
                resultMessage.className = 'result-message win-message';
                
                updateWagering(betAmount, winAmount);
            } else {
                balance -= betAmount;
                resultMessage.textContent = `–ü–†–û–ò–ì–†–´–®! -${betAmount} TON (${dice1}+${dice2}=${total})`;
                resultMessage.className = 'result-message lose-message';
                
                updateWagering(betAmount, 0);
            }
            
            resultMessage.style.display = 'block';
            updateBalance();
            
            addToHistory(actualWin, dice1, dice2, total, actualWin ? winAmount : -betAmount);
            
            if (isAutoPlay && balance >= betAmount) {
                setTimeout(playGame, 1500);
            } else if (balance < betAmount) {
                isAutoPlay = false;
                autoButton.innerHTML = '<i class="fas fa-redo"></i> –ê–≤—Ç–æ';
                autoButton.classList.remove('pulse');
            }
        }
        
        function addToHistory(win, dice1, dice2, total, amount) {
            const historyItem = document.createElement('div');
            historyItem.className = `history-item ${win ? 'win' : 'lose'}`;
            
            const time = new Date().toLocaleTimeString('ru-RU', { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
            
            historyItem.innerHTML = `
                <div class="history-info">
                    <div class="history-dice">${diceFaces[dice1-1]}${diceFaces[dice2-1]}</div>
                    <div class="history-details">
                        <h4>${dice1} + ${dice2} = ${total}</h4>
                        <p>${time} ‚Ä¢ ${isBetLow ? '–ú–µ–Ω—å—à–µ 7' : '–ë–æ–ª—å—à–µ 7'}</p>
                    </div>
                </div>
                <div class="history-amount ${amount > 0 ? 'positive' : 'negative'}">
                    ${amount > 0 ? '+' : ''}${amount} TON
                </div>
            `;
            
            historyList.insertBefore(historyItem, historyList.firstChild);
            gameHistory.unshift({ 
                win, 
                dice1, 
                dice2, 
                total, 
                amount, 
                timestamp: new Date(),
                betType: isBetLow ? 'low' : 'high'
            });
            
            updateStats();
            saveGameHistory();
            
            if (historyList.children.length > 20) {
                historyList.removeChild(historyList.lastChild);
                gameHistory.pop();
            }
        }
        
        function updateStats() {
            const wins = gameHistory.filter(g => g.win).length;
            const totalGamesCount = gameHistory.length;
            
            totalWins.textContent = wins;
            totalGames.textContent = totalGamesCount;
            
            const totalDeposited = depositHistory
                .filter(d => d.status === 'confirmed')
                .reduce((sum, d) => sum + d.amount, 0);
            totalDeposits.textContent = totalDeposited.toLocaleString('ru-RU') + ' TON';
            
            const totalWithdrawn = withdrawHistory
                .filter(w => w.status === 'completed')
                .reduce((sum, w) => sum + w.amount, 0);
            totalWithdrawals.textContent = totalWithdrawn.toLocaleString('ru-RU') + ' TON';
        }
        
        function updateWithdrawHistory() {
            withdrawHistoryList.innerHTML = '';
            
            if (withdrawHistory.length === 0) {
                withdrawHistoryList.innerHTML = `
                    <div style="text-align: center; padding: 30px 20px; color: var(--text-secondary);">
                        <i class="fas fa-exchange-alt" style="font-size: 2.5rem; margin-bottom: 15px; opacity: 0.5;"></i>
                        <p style="font-size: 0.9rem;">–ò—Å—Ç–æ—Ä–∏—è –≤—ã–≤–æ–¥–æ–≤ –ø—É—Å—Ç–∞</p>
                    </div>
                `;
                return;
            }
            
            const sortedHistory = [...withdrawHistory].sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            
            sortedHistory.forEach(withdraw => {
                const item = document.createElement('div');
                item.className = 'withdraw-history-item';
                
                const date = new Date(withdraw.timestamp).toLocaleDateString('ru-RU');
                const time = new Date(withdraw.timestamp).toLocaleTimeString('ru-RU', { 
                    hour: '2-digit', 
                    minute: '2-digit' 
                });
                
                item.innerHTML = `
                    <div class="withdraw-history-info">
                        <h4>${withdraw.amount.toLocaleString('ru-RU')} TON</h4>
                        <div class="withdraw-history-details">
                            <p>${date} ${time}</p>
                            <p>TON ‚Ä¢ ${withdraw.wallet ? withdraw.wallet.substring(0, 8) + '...' : ''}</p>
                        </div>
                    </div>
                    <div class="withdraw-history-amount">
                        ${withdraw.amount.toLocaleString('ru-RU')} TON
                    </div>
                `;
                
                withdrawHistoryList.appendChild(item);
            });
        }
        
        function playGame() {
            if (balance < betAmount) {
                showNotification('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤', '–ü–æ–ø–æ–ª–Ω–∏—Ç–µ –±–∞–ª–∞–Ω—Å –¥–ª—è –∏–≥—Ä—ã', 'error');
                return;
            }
            
            playButton.disabled = true;
            playButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> –ë—Ä–æ—Å–æ–∫...';
            
            setTimeout(() => {
                rollDice();
                playButton.disabled = false;
                playButton.innerHTML = '<i class="fas fa-play"></i> –ò–≥—Ä–∞—Ç—å';
            }, 500);
        }
        
        // ========== –î–ï–ü–û–ó–ò–¢ ==========
        function openDepositModal() {
            depositDetails.style.display = 'none';
            depositNextBtn.style.display = 'flex';
            sendPaymentBtn.style.display = 'none';
            
            currentPaymentId = generatePaymentId();
            
            if (isTonConnected && tonAccount) {
                updateDepositModalForConnectedWallet();
            } else {
                updateDepositModalForDisconnectedWallet();
            }
            
            depositModal.classList.add('active');
        }
        
        function handleDepositNext() {
            const amount = parseInt(depositAmountInput.value) || 10;
            if (amount < 1) {
                showNotification('–û—à–∏–±–∫–∞', '–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è 1 TON', 'error');
                return;
            }
            
            let bonus = 0;
            if (amount >= 100) {
                bonus = BONUS_AMOUNT;
            }
            const totalAmount = amount + bonus;
            
            finalAmountElement.textContent = amount.toLocaleString('ru-RU') + ' TON';
            depositTonAmount.textContent = amount.toLocaleString('ru-RU') + ' TON';
            depositBonus.textContent = `+${bonus} TON`;
            depositTotal.textContent = totalAmount.toLocaleString('ru-RU') + ' TON';
            
            depositDetails.style.display = 'block';
            depositNextBtn.style.display = 'none';
            
            if (isTonConnected && tonAccount) {
                sendPaymentBtn.style.display = 'flex';
                sendPaymentBtn.disabled = false;
                sendPaymentBtn.innerHTML = `<i class="fas fa-coins"></i> –û—Ç–ø—Ä–∞–≤–∏—Ç—å ${amount} TON`;
            }
        }
        
        async function handleSendPayment() {
            const amount = parseInt(depositAmountInput.value) || 10;
            
            let bonus = 0;
            if (amount >= 100) {
                bonus = BONUS_AMOUNT;
            }
            
            const success = await sendTonTransaction(amount);
            
            if (success) {
                balance += amount;
                addDepositToBonus(amount);
                
                depositHistory.push({
                    id: currentPaymentId,
                    amount: amount,
                    bonus: bonus,
                    status: 'confirmed',
                    timestamp: new Date(),
                    method: 'tonkeeper'
                });
                
                saveDepositHistory();
                updateBalance();
                
                const message = `üé≤ <b>WENRY DICE | –ù–æ–≤—ã–π –¥–µ–ø–æ–∑–∏—Ç</b>\n\n` +
                              `ID: <code>${currentPaymentId}</code>\n` +
                              `–ò–≥—Ä–æ–∫: <b>${currentUser?.first_name || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}</b>\n` +
                              `TG ID: <code>${currentUser?.id || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}</code>\n` +
                              `–°—É–º–º–∞: <b>${amount} TON</b>\n` +
                              `–ë–æ–Ω—É—Å: <b>+${bonus} TON</b>\n` +
                              `–ò—Ç–æ–≥–æ: <b>${amount + bonus} TON</b>\n\n` +
                              `–í—Ä–µ–º—è: ${new Date().toLocaleString('ru-RU')}`;
                
                await sendTelegramMessage(ADMIN_ID, message);
                
                setTimeout(() => {
                    depositModal.classList.remove('active');
                    sendPaymentBtn.disabled = false;
                    sendPaymentBtn.innerHTML = '<i class="fas fa-coins"></i> –û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–ª–∞—Ç–µ–∂';
                    showNotification('–£—Å–ø–µ—à–Ω–æ!', `–ë–∞–ª–∞–Ω—Å –ø–æ–ø–æ–ª–Ω–µ–Ω –Ω–∞ ${amount} TON${bonus > 0 ? ` (+${bonus} TON –±–æ–Ω—É—Å)` : ''}`, 'success');
                }, 1500);
            }
        }
        
        // ========== –í–´–í–û–î ==========
        function openWithdrawModal() {
            if (balance < 1) {
                showNotification('–û—à–∏–±–∫–∞', '–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –≤—ã–≤–æ–¥–∞ 1 TON', 'error');
                return;
            }
            
            withdrawDetails.style.display = 'none';
            withdrawNextBtn.style.display = 'flex';
            withdrawConfirmBtn.style.display = 'none';
            tonWalletInput.style.display = 'block';
            tonWalletAddress.value = '';
            
            withdrawAmountInput.max = Math.floor(balance);
            
            currentWithdrawId = generateWithdrawId();
            
            withdrawModal.classList.add('active');
        }
        
        function handleWithdrawNext() {
            const amount = parseInt(withdrawAmountInput.value) || 10;
            
            if (amount > balance) {
                showNotification('–û—à–∏–±–∫–∞', '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ –Ω–∞ –±–∞–ª–∞–Ω—Å–µ', 'error');
                return;
            }
            
            if (amount < 1) {
                showNotification('–û—à–∏–±–∫–∞', '–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –≤—ã–≤–æ–¥–∞ 1 TON', 'error');
                return;
            }
            
            const walletAddress = tonWalletAddress.value.trim();
            if (!validateTonAddress(walletAddress)) {
                showNotification('–û—à–∏–±–∫–∞', '–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –∞–¥—Ä–µ—Å –∫–æ—à–µ–ª—å–∫–∞ TON', 'error');
                return;
            }
            
            withdrawTotalElement.textContent = amount.toLocaleString('ru-RU') + ' TON';
            withdrawFeeElement.textContent = '0 TON';
            withdrawNetElement.textContent = amount.toLocaleString('ru-RU') + ' TON';
            
            withdrawDetails.style.display = 'block';
            withdrawNextBtn.style.display = 'none';
            withdrawConfirmBtn.style.display = 'flex';
        }
        
        async function handleWithdrawConfirm() {
            const amount = parseInt(withdrawAmountInput.value) || 10;
            const walletAddress = tonWalletAddress.value.trim();
            
            if (!validateTonAddress(walletAddress)) {
                showNotification('–û—à–∏–±–∫–∞', '–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –∞–¥—Ä–µ—Å –∫–æ—à–µ–ª—å–∫–∞ TON', 'error');
                return;
            }
            
            if (bonusData.bonusActive) {
                showNotification('–û—à–∏–±–∫–∞', '–ó–∞–≤–µ—Ä—à–∏—Ç–µ –æ—Ç—ã–≥—Ä—ã—à –±–æ–Ω—É—Å–∞ –ø–µ—Ä–µ–¥ –≤—ã–≤–æ–¥–æ–º', 'error');
                return;
            }
            
            withdrawConfirmBtn.disabled = true;
            withdrawConfirmBtn.innerHTML = '<div class="loader"></div> –û–±—Ä–∞–±–æ—Ç–∫–∞...';
            
            balance -= amount;
            updateBalance();
            
            const withdrawData = {
                id: currentWithdrawId,
                amount: amount,
                netAmount: amount,
                method: 'ton',
                wallet: walletAddress,
                status: 'pending',
                timestamp: new Date()
            };
            
            withdrawHistory.unshift(withdrawData);
            saveWithdrawHistory();
            updateWithdrawHistory();
            
            const message = `üé≤ <b>WENRY DICE | –ù–æ–≤–∞—è –∑–∞—è–≤–∫–∞ –Ω–∞ –≤—ã–≤–æ–¥</b>\n\n` +
                          `ID: <code>${currentWithdrawId}</code>\n` +
                          `–ò–≥—Ä–æ–∫: <b>${currentUser?.first_name || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}</b>\n` +
                          `TG ID: <code>${currentUser?.id || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}</code>\n` +
                          `–°—É–º–º–∞: <b>${amount} TON</b>\n` +
                          `–ê–¥—Ä–µ—Å: <code>${walletAddress}</code>\n\n` +
                          `–í—Ä–µ–º—è: ${new Date().toLocaleString('ru-RU')}\n\n` +
                          `‚ö†Ô∏è <i>–°—Ä–µ–¥—Å—Ç–≤–∞ —É–∂–µ —Å–ø–∏—Å–∞–Ω—ã —Å –±–∞–ª–∞–Ω—Å–∞ –∏–≥—Ä–æ–∫–∞</i>`;
            
            await sendTelegramMessage(ADMIN_ID, message);
            
            showNotification('‚úÖ –ó–∞—è–≤–∫–∞ –ø—Ä–∏–Ω—è—Ç–∞!', `–°—Ä–µ–¥—Å—Ç–≤–∞ –±—É–¥—É—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –≤ —Ç–µ—á–µ–Ω–∏–µ 8 —á–∞—Å–æ–≤. –°—É–º–º–∞ ${amount} TON —Å–ø–∏—Å–∞–Ω–∞ —Å –±–∞–ª–∞–Ω—Å–∞.`, 'success');
            
            setTimeout(() => {
                withdrawModal.classList.remove('active');
                withdrawConfirmBtn.disabled = false;
                withdrawConfirmBtn.innerHTML = '<i class="fas fa-check"></i> –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –≤—ã–≤–æ–¥';
            }, 2000);
        }
        
        // ========== –°–û–•–†–ê–ù–ï–ù–ò–ï –î–ê–ù–ù–´–• ==========
        function saveGameHistory() {
            localStorage.setItem('wenry_history', JSON.stringify(gameHistory.slice(0, 50)));
        }
        
        function saveDepositHistory() {
            localStorage.setItem('wenry_deposits', JSON.stringify(depositHistory));
        }
        
        function saveWithdrawHistory() {
            localStorage.setItem('wenry_withdrawals', JSON.stringify(withdrawHistory));
        }
        
        function saveBonusData() {
            localStorage.setItem('wenry_bonus', JSON.stringify(bonusData));
        }
        
        function loadSavedData() {
            const savedBalance = localStorage.getItem('wenry_balance');
            if (savedBalance) {
                balance = parseInt(savedBalance);
            }
            
            const savedHistory = localStorage.getItem('wenry_history');
            if (savedHistory) {
                try {
                    gameHistory = JSON.parse(savedHistory);
                    gameHistory.forEach(game => {
                        const time = new Date(game.timestamp).toLocaleTimeString('ru-RU', { 
                            hour: '2-digit', 
                            minute: '2-digit' 
                        });
                        
                        const historyItem = document.createElement('div');
                        historyItem.className = `history-item ${game.win ? 'win' : 'lose'}`;
                        historyItem.innerHTML = `
                            <div class="history-info">
                                <div class="history-dice">${diceFaces[game.dice1-1]}${diceFaces[game.dice2-1]}</div>
                                <div class="history-details">
                                    <h4>${game.dice1} + ${game.dice2} = ${game.total}</h4>
                                    <p>${time} ‚Ä¢ ${game.betType === 'low' ? '–ú–µ–Ω—å—à–µ 7' : '–ë–æ–ª—å—à–µ 7'}</p>
                                </div>
                            </div>
                            <div class="history-amount ${game.amount > 0 ? 'positive' : 'negative'}">
                                ${game.amount > 0 ? '+' : ''}${game.amount} TON
                            </div>
                        `;
                        historyList.appendChild(historyItem);
                    });
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏ –∏–≥—Ä:', e);
                }
            }
            
            const savedDeposits = localStorage.getItem('wenry_deposits');
            if (savedDeposits) {
                try {
                    depositHistory = JSON.parse(savedDeposits);
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–µ–ø–æ–∑–∏—Ç–æ–≤:', e);
                }
            }
            
            const savedWithdrawals = localStorage.getItem('wenry_withdrawals');
            if (savedWithdrawals) {
                try {
                    withdrawHistory = JSON.parse(savedWithdrawals);
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤—ã–≤–æ–¥–æ–≤:', e);
                }
            }
            
            const savedBonus = localStorage.getItem('wenry_bonus');
            if (savedBonus) {
                try {
                    bonusData = JSON.parse(savedBonus);
                    if (bonusData.bonusActivatedAt) {
                        bonusData.bonusActivatedAt = new Date(bonusData.bonusActivatedAt);
                    }
                    if (bonusData.bonusExpiresAt) {
                        bonusData.bonusExpiresAt = new Date(bonusData.bonusExpiresAt);
                    }
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –±–æ–Ω—É—Å–æ–≤:', e);
                }
            }
        }
        
        // ========== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ==========
        document.addEventListener('DOMContentLoaded', async function() {
            tg.ready();
            tg.expand();
            tg.setHeaderColor('#0f0f0f');
            tg.setBackgroundColor('#0f0f0f');
            
            if (tg.initDataUnsafe.user) {
                currentUser = tg.initDataUnsafe.user;
                userName.textContent = currentUser.first_name || '–ò–≥—Ä–æ–∫';
                userId.textContent = `ID: ${currentUser.id}`;
                userUsername.textContent = currentUser.username ? `@${currentUser.username}` : '–ù–µ—Ç –Ω–∏–∫–Ω–µ–π–º–∞';
                userGreeting.textContent = `${currentUser.first_name} | Wenry Dice`;
                
                if (currentUser.photo_url) {
                    userAvatar.style.backgroundImage = `url(${currentUser.photo_url})`;
                    userAvatar.style.backgroundSize = 'cover';
                    userAvatar.style.backgroundPosition = 'center';
                    userAvatar.innerHTML = '';
                }
            }
            
            loadSavedData();
            updateBalance();
            updateBetAmount();
            updateStats();
            updateWithdrawHistory();
            updateBonusUI();
            
            setTimeout(() => {
                initTonConnect();
            }, 1000);
            
            // ========== –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –°–û–ë–´–¢–ò–ô ==========
            
            // –ù–∞–≤–∏–≥–∞—Ü–∏—è
            navButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    const section = this.getAttribute('data-section');
                    
                    navButtons.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    Object.values(sections).forEach(s => s.classList.remove('active'));
                    sections[section].classList.add('active');
                });
            });
            
            // –ë–æ–Ω—É—Å—ã
            activateBonusBtn.addEventListener('click', activateBonus);
            
            bonusInfoBtn.addEventListener('click', function() {
                showNotification(
                    '‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–æ–Ω—É—Å–∞—Ö',
                    '‚Ä¢ –ü—Ä–∏ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–∏ 100 TON –≤—ã –ø–æ–ª—É—á–∞–µ—Ç–µ –±–æ–Ω—É—Å +45 TON\n' +
                    '‚Ä¢ –î–ª—è –≤—ã–≤–æ–¥–∞ –±–æ–Ω—É—Å–∞ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –æ—Ç—ã–≥—Ä—ã—à 2x\n' +
                    '‚Ä¢ –ë–æ–Ω—É—Å –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω 7 –¥–Ω–µ–π\n' +
                    '‚Ä¢ –ë–æ–Ω—É—Å –Ω–µ–ª—å–∑—è –≤—ã–≤–µ—Å—Ç–∏ –±–µ–∑ –æ—Ç—ã–≥—Ä—ã—à–∞',
                    'info'
                );
            });
            
            // –î–µ–ø–æ–∑–∏—Ç –∫–Ω–æ–ø–∫–∏
            depositBtns.forEach(btn => {
                btn.addEventListener('click', openDepositModal);
            });
            
            depositCloseBtn.addEventListener('click', () => {
                depositModal.classList.remove('active');
            });
            
            depositModal.addEventListener('click', function(e) {
                if (e.target === this) depositModal.classList.remove('active');
            });
            
            depositNextBtn.addEventListener('click', handleDepositNext);
            sendPaymentBtn.addEventListener('click', handleSendPayment);
            
            // –í—ã–≤–æ–¥ –∫–Ω–æ–ø–∫–∏
            withdrawBtns.forEach(btn => {
                btn.addEventListener('click', openWithdrawModal);
            });
            
            withdrawCloseBtn.addEventListener('click', () => {
                withdrawModal.classList.remove('active');
            });
            
            withdrawModal.addEventListener('click', function(e) {
                if (e.target === this) withdrawModal.classList.remove('active');
            });
            
            withdrawNextBtn.addEventListener('click', handleWithdrawNext);
            withdrawConfirmBtn.addEventListener('click', handleWithdrawConfirm);
            
            // –í–≤–æ–¥ —Å—É–º–º—ã –≤—ã–≤–æ–¥–∞
            withdrawAmountInput.addEventListener('input', function() {
                let amount = parseInt(this.value) || 0;
                if (amount < 1) amount = 1;
                if (amount > balance) amount = Math.floor(balance);
                this.value = amount;
            });
            
            // –ë—ã—Å—Ç—Ä—ã–π –≤—ã–±–æ—Ä —Å—É–º–º—ã
            amountSuggestions.forEach(btn => {
                btn.addEventListener('click', function() {
                    const amount = parseInt(this.getAttribute('data-amount'));
                    const modal = this.closest('.modal-overlay');
                    
                    if (modal.id === 'depositModal') {
                        depositAmountInput.value = amount;
                    } else {
                        if (amount > balance) {
                            showNotification('–û—à–∏–±–∫–∞', '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤', 'error');
                            return;
                        }
                        withdrawAmountInput.value = amount;
                    }
                });
            });
            
            // –í–≤–æ–¥ —Å—É–º–º—ã –¥–µ–ø–æ–∑–∏—Ç–∞
            depositAmountInput.addEventListener('input', function() {
                let amount = parseInt(this.value) || 0;
                if (amount < 1) amount = 1;
                if (amount > 10000) amount = 10000;
                this.value = amount;
            });
            
            // –ò–≥—Ä–æ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
            betSlider.addEventListener('input', function() {
                betAmount = parseInt(this.value);
                updateBetAmount();
            });
            
            document.querySelectorAll('.amount-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const action = this.getAttribute('data-action');
                    
                    switch(action) {
                        case 'half':
                            betAmount = Math.max(1, Math.floor(betAmount / 2));
                            break;
                        case 'double':
                            betAmount = Math.min(100, betAmount * 2);
                            break;
                        case 'min':
                            betAmount = 1;
                            break;
                        case 'max':
                            betAmount = 100;
                            break;
                    }
                    
                    updateBetAmount();
                });
            });
            
            betLowButton.addEventListener('click', function() {
                if (!isBetLow) {
                    isBetLow = true;
                    betLowButton.classList.add('active');
                    betHighButton.classList.remove('active');
                }
            });
            
            betHighButton.addEventListener('click', function() {
                if (isBetLow) {
                    isBetLow = false;
                    betHighButton.classList.add('active');
                    betLowButton.classList.remove('active');
                }
            });
            
            playButton.addEventListener('click', playGame);
            
            autoButton.addEventListener('click', function() {
                if (balance < betAmount) {
                    showNotification('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤', '–ü–æ–ø–æ–ª–Ω–∏—Ç–µ –±–∞–ª–∞–Ω—Å', 'error');
                    return;
                }
                
                isAutoPlay = !isAutoPlay;
                
                if (isAutoPlay) {
                    this.innerHTML = '<i class="fas fa-stop"></i> –°—Ç–æ–ø';
                    this.classList.add('pulse');
                    playGame();
                } else {
                    this.innerHTML = '<i class="fas fa-redo"></i> –ê–≤—Ç–æ';
                    this.classList.remove('pulse');
                }
            });
            
            // –û—á–∏—Å—Ç–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏
            clearHistoryButton.addEventListener('click', function() {
                if (confirm('–û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –∏–≥—Ä?')) {
                    historyList.innerHTML = '';
                    gameHistory = [];
                    localStorage.removeItem('wenry_history');
                    updateStats();
                    showNotification('–ò—Å—Ç–æ—Ä–∏—è –æ—á–∏—â–µ–Ω–∞', '–í—Å–µ –∑–∞–ø–∏—Å–∏ —É–¥–∞–ª–µ–Ω—ã', 'info');
                }
            });
            
            // –ü—Ä–æ—Ñ–∏–ª—å –∫–Ω–æ–ø–∫–∏
            document.getElementById('statsBtn').addEventListener('click', function() {
                const winRate = gameHistory.length > 0 
                    ? Math.round((gameHistory.filter(g => g.win).length / gameHistory.length) * 100)
                    : 0;
                
                const totalWon = gameHistory.reduce((sum, g) => sum + (g.amount > 0 ? g.amount : 0), 0);
                const totalLost = gameHistory.reduce((sum, g) => sum + (g.amount < 0 ? -g.amount : 0), 0);
                
                showNotification(
                    'üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞',
                    `–ò–≥—Ä: ${gameHistory.length}\n` +
                    `–ü–æ–±–µ–¥: ${gameHistory.filter(g => g.win).length}\n` +
                    `–ü—Ä–æ—Ü–µ–Ω—Ç –ø–æ–±–µ–¥: ${winRate}%\n` +
                    `–í—ã–∏–≥—Ä–∞–Ω–æ: ${totalWon} TON\n` +
                    `–ü—Ä–æ–∏–≥—Ä–∞–Ω–æ: ${totalLost} TON`,
                    'info'
                );
            });
            
            document.getElementById('supportBtn').addEventListener('click', function() {
                window.open('https://t.me/wenrydice_support', '_blank');
            });
            
            document.getElementById('logoutBtn').addEventListener('click', function() {
                if (confirm('–í—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞?')) {
                    showNotification('–í—ã—Ö–æ–¥', '–í—ã —É—Å–ø–µ—à–Ω–æ –≤—ã—à–ª–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã', 'info');
                    setTimeout(() => {
                        tg.close();
                    }, 2000);
                }
            });
        });
    </script>
</body>
</html>
