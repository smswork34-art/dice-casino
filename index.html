<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TON Casino - –ì–æ–Ω–∫–∏</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 100%);
            color: white;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .game-container {
            max-width: 500px;
            width: 100%;
            background: rgba(25, 25, 35, 0.95);
            border-radius: 24px;
            overflow: hidden;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(42, 171, 238, 0.3);
            backdrop-filter: blur(10px);
        }

        /* HEADER */
        .game-header {
            background: linear-gradient(135deg, #2aabee 0%, #1a5b7a 100%);
            padding: 24px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .game-header::before {
            content: 'üèÅ';
            position: absolute;
            font-size: 120px;
            opacity: 0.1;
            right: 20px;
            top: 10px;
            transform: rotate(15deg);
        }

        .game-title {
            font-size: 32px;
            font-weight: 900;
            letter-spacing: 2px;
            margin-bottom: 8px;
            text-transform: uppercase;
            text-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        .game-subtitle {
            font-size: 14px;
            opacity: 0.9;
            letter-spacing: 1px;
        }

        /* GAME CONTENT */
        .game-content {
            padding: 30px;
        }

        /* BALANCE */
        .balance-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 30px;
            border: 1px solid rgba(42, 171, 238, 0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .balance-amount {
            font-size: 28px;
            font-weight: 800;
            background: linear-gradient(135deg, #4CAF50 0%, #2E7D32 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .balance-label {
            font-size: 14px;
            opacity: 0.7;
        }

        /* BET CONTROLS */
        .bet-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 30px;
            border: 1px solid rgba(42, 171, 238, 0.2);
        }

        .bet-title {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .bet-title::before {
            content: 'üí∞';
            font-size: 24px;
        }

        .bet-buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            margin-bottom: 25px;
        }

        .bet-btn {
            background: rgba(255, 255, 255, 0.08);
            border: 2px solid rgba(42, 171, 238, 0.3);
            border-radius: 12px;
            padding: 16px;
            font-size: 18px;
            font-weight: 700;
            color: #2aabee;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .bet-btn:hover {
            background: rgba(42, 171, 238, 0.15);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(42, 171, 238, 0.2);
        }

        .bet-btn.active {
            background: linear-gradient(135deg, #2aabee 0%, #229ed9 100%);
            border-color: #2aabee;
            color: white;
            box-shadow: 0 5px 20px rgba(42, 171, 238, 0.4);
        }

        /* RACE TRACK */
        .race-track {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 30px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            position: relative;
            overflow: hidden;
        }

        .track-lines {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: repeating-linear-gradient(
                to bottom,
                transparent,
                transparent 20px,
                rgba(255, 255, 255, 0.1) 20px,
                rgba(255, 255, 255, 0.1) 40px
            );
        }

        .finish-line {
            position: absolute;
            right: 50px;
            top: 0;
            bottom: 0;
            width: 4px;
            background: repeating-linear-gradient(
                to bottom,
                #fff 0px,
                #fff 10px,
                #000 10px,
                #000 20px
            );
            z-index: 2;
        }

        .finish-line::after {
            content: 'üèÅ';
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 24px;
        }

        .car {
            position: relative;
            height: 60px;
            margin-bottom: 10px;
            transition: left 0.1s linear;
        }

        .car-body {
            position: absolute;
            width: 120px;
            height: 40px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            padding: 0 15px;
            font-size: 20px;
            font-weight: bold;
            transition: all 0.3s;
        }

        .car-1 .car-body {
            background: linear-gradient(135deg, #FF5252 0%, #D32F2F 100%);
            box-shadow: 0 4px 15px rgba(255, 82, 82, 0.4);
        }

        .car-2 .car-body {
            background: linear-gradient(135deg, #2aabee 0%, #229ed9 100%);
            box-shadow: 0 4px 15px rgba(42, 171, 238, 0.4);
        }

        .car-3 .car-body {
            background: linear-gradient(135deg, #4CAF50 0%, #388E3C 100%);
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.4);
        }

        .car-4 .car-body {
            background: linear-gradient(135deg, #FFC107 0%, #FFA000 100%);
            box-shadow: 0 4px 15px rgba(255, 193, 7, 0.4);
        }

        .car-number {
            background: white;
            color: black;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
            font-weight: 900;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }

        .car-smoke {
            position: absolute;
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            filter: blur(5px);
            opacity: 0;
            left: -20px;
            top: 50%;
            transform: translateY(-50%);
        }

        /* CAR SELECTION */
        .car-selection {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }

        .car-select-btn {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .car-select-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .car-select-btn.selected {
            border-color: #2aabee;
            background: rgba(42, 171, 238, 0.15);
            box-shadow: 0 5px 20px rgba(42, 171, 238, 0.3);
        }

        .car-icon {
            font-size: 32px;
            margin-bottom: 10px;
        }

        .car-name {
            font-size: 14px;
            font-weight: 600;
        }

        /* CONTROLS */
        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }

        .control-btn {
            flex: 1;
            padding: 20px;
            border: none;
            border-radius: 16px;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .start-btn {
            background: linear-gradient(135deg, #4CAF50 0%, #2E7D32 100%);
            color: white;
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.3);
        }

        .start-btn:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(76, 175, 80, 0.4);
        }

        .start-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .reset-btn {
            background: linear-gradient(135deg, #f44336 0%, #d32f2f 100%);
            color: white;
            box-shadow: 0 6px 20px rgba(244, 67, 54, 0.3);
        }

        .reset-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(244, 67, 54, 0.4);
        }

        /* STATS */
        .stats-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            padding: 20px;
            border: 1px solid rgba(42, 171, 238, 0.2);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .stat-card {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            padding: 15px;
            text-align: center;
        }

        .stat-value {
            font-size: 24px;
            font-weight: 800;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 12px;
            opacity: 0.7;
        }

        /* RESULTS */
        .result-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            animation: fadeIn 0.5s ease;
        }

        .result-content {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border-radius: 24px;
            padding: 40px;
            max-width: 400px;
            width: 90%;
            text-align: center;
            border: 2px solid #2aabee;
            box-shadow: 0 20px 50px rgba(42, 171, 238, 0.3);
            animation: scaleIn 0.5s ease;
        }

        .result-icon {
            font-size: 80px;
            margin-bottom: 20px;
            animation: bounce 1s ease infinite;
        }

        .result-title {
            font-size: 32px;
            font-weight: 900;
            margin-bottom: 15px;
        }

        .result-message {
            font-size: 18px;
            margin-bottom: 25px;
            opacity: 0.9;
        }

        .result-amount {
            font-size: 42px;
            font-weight: 900;
            margin-bottom: 30px;
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .result-btn {
            background: linear-gradient(135deg, #2aabee 0%, #229ed9 100%);
            color: white;
            border: none;
            border-radius: 16px;
            padding: 18px 40px;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
        }

        .result-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(42, 171, 238, 0.4);
        }

        /* ANIMATIONS */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes scaleIn {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        @keyframes smoke {
            0% { opacity: 0; transform: translateX(0) scale(0.5); }
            50% { opacity: 1; }
            100% { opacity: 0; transform: translateX(-20px) scale(1); }
        }

        .smoking .car-smoke {
            animation: smoke 0.5s ease-out infinite;
        }

        /* NOTIFICATION */
        .notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(-100px);
            background: white;
            color: #1a1a1a;
            padding: 16px 32px;
            border-radius: 50px;
            font-weight: 600;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            z-index: 1001;
            transition: transform 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
            border: 2px solid #e6f4ff;
            font-size: 16px;
            text-align: center;
            min-width: 300px;
        }

        .notification.win {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            border-color: rgba(76, 175, 80, 0.3);
        }

        .notification.lose {
            background: linear-gradient(135deg, #ff6b6b 0%, #ff5252 100%);
            color: white;
            border-color: rgba(255, 107, 107, 0.3);
        }

        .notification.info {
            background: linear-gradient(135deg, #2aabee 0%, #229ed9 100%);
            color: white;
            border-color: rgba(42, 171, 238, 0.3);
        }

        /* RESPONSIVE */
        @media (max-width: 480px) {
            .game-content {
                padding: 20px;
            }
            
            .bet-buttons {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .car-selection {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .controls {
                flex-direction: column;
            }
            
            .car-body {
                width: 100px;
                font-size: 16px;
            }
            
            .result-content {
                padding: 30px 20px;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <!-- HEADER -->
        <div class="game-header">
            <h1 class="game-title">üèÅ –ì–æ–Ω–∫–∏</h1>
            <p class="game-subtitle">–í—ã–±–µ—Ä–∏ –º–∞—à–∏–Ω—É, —Å–¥–µ–ª–∞–π —Å—Ç–∞–≤–∫—É –∏ –ø–æ–±–µ–∂–¥–∞–π!</p>
        </div>

        <!-- GAME CONTENT -->
        <div class="game-content">
            <!-- BALANCE -->
            <div class="balance-section">
                <div>
                    <div class="balance-label">–¢–≤–æ–π –±–∞–ª–∞–Ω—Å</div>
                    <div class="balance-amount" id="balanceAmount">1,500 TON</div>
                </div>
                <button class="reset-btn" onclick="resetGame()" style="padding: 10px 20px; font-size: 14px;">
                    üîÑ –°–±—Ä–æ—Å–∏—Ç—å –∏–≥—Ä—É
                </button>
            </div>

            <!-- BET SECTION -->
            <div class="bet-section">
                <div class="bet-title">–°—Ç–∞–≤–∫–∞</div>
                <div class="bet-buttons">
                    <button class="bet-btn" data-bet="10">10 TON</button>
                    <button class="bet-btn" data-bet="50">50 TON</button>
                    <button class="bet-btn active" data-bet="100">100 TON</button>
                    <button class="bet-btn" data-bet="500">500 TON</button>
                </div>
                <div style="text-align: center; font-size: 14px; opacity: 0.8;">
                    üí∞ –í—ã–∏–≥—Ä—ã—à: √ó2.5 –∑–∞ 1 –º–µ—Å—Ç–æ | √ó1.5 –∑–∞ 2 –º–µ—Å—Ç–æ | √ó1.2 –∑–∞ 3 –º–µ—Å—Ç–æ
                </div>
            </div>

            <!-- CAR SELECTION -->
            <div style="margin-bottom: 20px;">
                <div class="bet-title">–í—ã–±–µ—Ä–∏ –º–∞—à–∏–Ω—É</div>
                <div class="car-selection">
                    <div class="car-select-btn selected" data-car="1">
                        <div class="car-icon">üèéÔ∏è</div>
                        <div class="car-name">–ö—Ä–∞—Å–Ω—ã–π</div>
                    </div>
                    <div class="car-select-btn" data-car="2">
                        <div class="car-icon">üöô</div>
                        <div class="car-name">–°–∏–Ω–∏–π</div>
                    </div>
                    <div class="car-select-btn" data-car="3">
                        <div class="car-icon">üöó</div>
                        <div class="car-name">–ó–µ–ª–µ–Ω—ã–π</div>
                    </div>
                    <div class="car-select-btn" data-car="4">
                        <div class="car-icon">üöò</div>
                        <div class="car-name">–ñ–µ–ª—Ç—ã–π</div>
                    </div>
                </div>
            </div>

            <!-- RACE TRACK -->
            <div class="race-track" id="raceTrack">
                <div class="track-lines"></div>
                <div class="finish-line"></div>
                
                <!-- Car 1 (Red) -->
                <div class="car car-1" id="car1">
                    <div class="car-body" style="left: 0;">
                        <div class="car-number">1</div>
                        <div>üî• –ö—Ä–∞—Å–Ω—ã–π</div>
                    </div>
                    <div class="car-smoke"></div>
                </div>
                
                <!-- Car 2 (Blue) -->
                <div class="car car-2" id="car2">
                    <div class="car-body" style="left: 0;">
                        <div class="car-number">2</div>
                        <div>‚ö° –°–∏–Ω–∏–π</div>
                    </div>
                    <div class="car-smoke"></div>
                </div>
                
                <!-- Car 3 (Green) -->
                <div class="car car-3" id="car3">
                    <div class="car-body" style="left: 0;">
                        <div class="car-number">3</div>
                        <div>üí® –ó–µ–ª–µ–Ω—ã–π</div>
                    </div>
                    <div class="car-smoke"></div>
                </div>
                
                <!-- Car 4 (Yellow) -->
                <div class="car car-4" id="car4">
                    <div class="car-body" style="left: 0;">
                        <div class="car-number">4</div>
                        <div>üöÄ –ñ–µ–ª—Ç—ã–π</div>
                    </div>
                    <div class="car-smoke"></div>
                </div>
            </div>

            <!-- CONTROLS -->
            <div class="controls">
                <button class="control-btn start-btn" id="startRace" onclick="startRace()">
                    üèÅ –ù–ê–ß–ê–¢–¨ –ì–û–ù–ö–£
                </button>
            </div>

            <!-- STATS -->
            <div class="stats-section">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="gamesPlayed">0</div>
                        <div class="stat-label">–°—ã–≥—Ä–∞–Ω–æ –≥–æ–Ω–æ–∫</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="totalWins">0</div>
                        <div class="stat-label">–ü–æ–±–µ–¥</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="totalProfit">+0 TON</div>
                        <div class="stat-label">–ü—Ä–∏–±—ã–ª—å</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="winRate">0%</div>
                        <div class="stat-label">–ü—Ä–æ—Ü–µ–Ω—Ç –ø–æ–±–µ–¥</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- RESULT OVERLAY -->
    <div class="result-overlay" id="resultOverlay">
        <div class="result-content">
            <div class="result-icon" id="resultIcon">üéâ</div>
            <h2 class="result-title" id="resultTitle">–ü–û–ë–ï–î–ê!</h2>
            <p class="result-message" id="resultMessage">–í–∞—à–∞ –º–∞—à–∏–Ω–∞ –∑–∞–Ω—è–ª–∞ 1 –º–µ—Å—Ç–æ!</p>
            <div class="result-amount" id="resultAmount">+250 TON</div>
            <button class="result-btn" onclick="closeResult()">–ò–ì–†–ê–¢–¨ –°–ù–û–í–ê</button>
        </div>
    </div>

    <script>
        // ==================== –ò–ì–†–û–í–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï ====================
        let balance = 1500;
        let currentBet = 100;
        let selectedCar = 1;
        let raceInProgress = false;
        let gamesPlayed = 0;
        let totalWins = 0;
        let totalProfit = 0;
        
        // ==================== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ====================
        document.addEventListener('DOMContentLoaded', () => {
            loadStats();
            setupEventListeners();
            updateDisplay();
        });
        
        // ==================== –ù–ê–°–¢–†–û–ô–ö–ê –û–ë–†–ê–ë–û–¢–ß–ò–ö–û–í ====================
        function setupEventListeners() {
            // –ö–Ω–æ–ø–∫–∏ —Å—Ç–∞–≤–æ–∫
            document.querySelectorAll('.bet-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    if (raceInProgress) return;
                    
                    document.querySelectorAll('.bet-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentBet = parseInt(btn.dataset.bet);
                    
                    showNotification(`–°—Ç–∞–≤–∫–∞: ${currentBet} TON`, 'info');
                });
            });
            
            // –í—ã–±–æ—Ä –º–∞—à–∏–Ω—ã
            document.querySelectorAll('.car-select-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    if (raceInProgress) return;
                    
                    document.querySelectorAll('.car-select-btn').forEach(b => b.classList.remove('selected'));
                    btn.classList.add('selected');
                    selectedCar = parseInt(btn.dataset.car);
                    
                    showNotification(`–í—ã–±—Ä–∞–Ω–∞ –º–∞—à–∏–Ω–∞ ‚Ññ${selectedCar}`, 'info');
                });
            });
        }
        
        // ==================== –°–¢–ê–†–¢ –ì–û–ù–ö–ò ====================
        function startRace() {
            if (raceInProgress) return;
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞
            if (currentBet > balance) {
                showNotification('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤!', 'lose');
                return;
            }
            
            // –°–Ω–∏–º–∞–µ–º —Å—Ç–∞–≤–∫—É
            balance -= currentBet;
            gamesPlayed++;
            raceInProgress = true;
            
            // –ë–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫–∏
            document.getElementById('startRace').disabled = true;
            document.getElementById('startRace').innerHTML = 'üèÅ –ì–û–ù–ö–ê –ù–ê–ß–ê–õ–ê–°–¨!';
            
            showNotification('–ì–æ–Ω–∫–∞ –Ω–∞—á–∞–ª–∞—Å—å! üèéÔ∏èüí®', 'info');
            
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–∫–æ—Ä–æ—Å—Ç–∏ –¥–ª—è –º–∞—à–∏–Ω (—Å –ø–æ–¥–∫—Ä—É—Ç–∫–æ–π —à–∞–Ω—Å–æ–≤)
            const speeds = generateCarSpeeds();
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –≥–æ–Ω–∫–∏
            startRaceAnimation(speeds);
        }
        
        // ==================== –ì–ï–ù–ï–†–ê–¶–ò–Ø –°–ö–û–†–û–°–¢–ï–ô ====================
        function generateCarSpeeds() {
            const baseSpeed = 0.5; // –ë–∞–∑–æ–≤–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å
            
            // üîß –ü–û–î–ö–†–£–¢–ö–ê –®–ê–ù–°–û–í:
            // –£ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –º–∞—à–∏–Ω—ã —à–∞–Ω—Å –Ω–∞ –ø–æ–±–µ–¥—É ~20% –≤–º–µ—Å—Ç–æ 25%
            const isSelectedLucky = Math.random() > 0.8; // 20% —à–∞–Ω—Å —É–¥–∞—á–∏
            
            return [1, 2, 3, 4].map(carNumber => {
                let speed;
                
                if (carNumber === selectedCar) {
                    // –í—ã–±—Ä–∞–Ω–Ω–∞—è –º–∞—à–∏–Ω–∞
                    if (isSelectedLucky) {
                        // –£–¥–∞—á–∞! –í—ã—Å–æ–∫–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å
                        speed = baseSpeed * (Math.random() * 0.5 + 1.0); // 1.0-1.5x
                    } else {
                        // –ù–µ –ø–æ–≤–µ–∑–ª–æ - —Å—Ä–µ–¥–Ω—è—è —Å–∫–æ—Ä–æ—Å—Ç—å
                        speed = baseSpeed * (Math.random() * 0.4 + 0.6); // 0.6-1.0x
                    }
                } else {
                    // –î—Ä—É–≥–∏–µ –º–∞—à–∏–Ω—ã
                    const isOtherLucky = Math.random() > 0.85; // 15% —à–∞–Ω—Å —É–¥–∞—á–∏ –¥–ª—è –¥—Ä—É–≥–∏—Ö
                    
                    if (isOtherLucky) {
                        // –î—Ä—É–≥–∏–º —Ç–æ–∂–µ –º–æ–∂–µ—Ç –ø–æ–≤–µ–∑—Ç–∏
                        speed = baseSpeed * (Math.random() * 0.6 + 0.9); // 0.9-1.5x
                    } else {
                        // –û–±—ã—á–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å
                        speed = baseSpeed * (Math.random() * 0.5 + 0.5); // 0.5-1.0x
                    }
                }
                
                return Math.max(0.3, Math.min(1.0, speed)); // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º 0.3-1.0
            });
        }
        
        // ==================== –ê–ù–ò–ú–ê–¶–ò–Ø –ì–û–ù–ö–ò ====================
        function startRaceAnimation(speeds) {
            const cars = [
                document.getElementById('car1').querySelector('.car-body'),
                document.getElementById('car2').querySelector('.car-body'),
                document.getElementById('car3').querySelector('.car-body'),
                document.getElementById('car4').querySelector('.car-body')
            ];
            
            const smokeElements = [
                document.querySelector('.car-1 .car-smoke'),
                document.querySelector('.car-2 .car-smoke'),
                document.querySelector('.car-3 .car-smoke'),
                document.querySelector('.car-4 .car-smoke')
            ];
            
            // –í–∫–ª—é—á–∞–µ–º –¥—ã–º
            smokeElements.forEach(smoke => {
                smoke.parentElement.classList.add('smoking');
            });
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏–∏
            cars.forEach(car => {
                car.style.left = '0%';
                car.style.transition = 'left 0.1s linear';
            });
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º –≥–æ–Ω–∫—É
            let positions = [0, 0, 0, 0];
            const finishLine = 85; // 85% –¥–ª—è —Ñ–∏–Ω–∏—à–Ω–æ–π —á–µ—Ä—Ç—ã
            const raceDuration = 5000; // 5 —Å–µ–∫—É–Ω–¥ –≥–æ–Ω–∫–∏
            const startTime = Date.now();
            const results = [];
            
            function updateRace() {
                if (!raceInProgress) return;
                
                const elapsed = Date.now() - startTime;
                const progress = Math.min(elapsed / raceDuration, 1);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏–∏ –º–∞—à–∏–Ω
                for (let i = 0; i < 4; i++) {
                    // –î–æ–±–∞–≤–ª—è–µ–º –Ω–µ–±–æ–ª—å—à—É—é —Å–ª—É—á–∞–π–Ω–æ—Å—Ç—å –¥–ª—è —Ä–µ–∞–ª–∏–∑–º–∞
                    const randomFactor = 1 + (Math.random() - 0.5) * 0.1;
                    positions[i] = Math.min(
                        finishLine,
                        speeds[i] * progress * 100 * randomFactor
                    );
                    
                    cars[i].style.left = positions[i] + '%';
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º —Ç—Ä—è—Å–∫—É –Ω–∞ –≤—ã—Å–æ–∫–æ–π —Å–∫–æ—Ä–æ—Å—Ç–∏
                    if (positions[i] > 50) {
                        const shake = (Math.random() - 0.5) * 2;
                        cars[i].style.transform = `translateY(${shake}px)`;
                    }
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –¥–æ—Å—Ç–∏–≥–ª–∏ –ª–∏ —Ñ–∏–Ω–∏—à–∞
                if (progress >= 1 || positions.some(pos => pos >= finishLine)) {
                    endRace(positions);
                    return;
                }
                
                requestAnimationFrame(updateRace);
            }
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é
            updateRace();
        }
        
        // ==================== –ó–ê–í–ï–†–®–ï–ù–ò–ï –ì–û–ù–ö–ò ====================
        function endRace(finalPositions) {
            raceInProgress = false;
            
            // –í—ã–∫–ª—é—á–∞–µ–º –¥—ã–º
            document.querySelectorAll('.car').forEach(car => {
                car.classList.remove('smoking');
            });
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –º–µ—Å—Ç–∞
            const positionsWithIndex = finalPositions.map((pos, index) => ({ pos, index }));
            positionsWithIndex.sort((a, b) => b.pos - a.pos);
            
            const carPlaces = new Array(4);
            positionsWithIndex.forEach((item, place) => {
                carPlaces[item.index] = place + 1;
            });
            
            // –†–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–π –º–∞—à–∏–Ω—ã
            const playerPlace = carPlaces[selectedCar - 1];
            
            // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –≤—ã–∏–≥—Ä—ã—à
            let multiplier = 0;
            let winAmount = 0;
            
            if (playerPlace === 1) {
                multiplier = 2.5;
                winAmount = currentBet * multiplier;
                balance += winAmount;
                totalWins++;
                totalProfit += winAmount - currentBet;
                
                showResult('üéâ', '–ü–û–ë–ï–î–ê!', `–í–∞—à–∞ –º–∞—à–∏–Ω–∞ –∑–∞–Ω—è–ª–∞ 1 –º–µ—Å—Ç–æ!`, `+${winAmount} TON`);
            } else if (playerPlace === 2) {
                multiplier = 1.5;
                winAmount = currentBet * multiplier;
                balance += winAmount;
                totalWins++;
                totalProfit += winAmount - currentBet;
                
                showResult('ü•à', '–í–¢–û–†–û–ï –ú–ï–°–¢–û!', `–í–∞—à–∞ –º–∞—à–∏–Ω–∞ –∑–∞–Ω—è–ª–∞ 2 –º–µ—Å—Ç–æ!`, `+${winAmount} TON`);
            } else if (playerPlace === 3) {
                multiplier = 1.2;
                winAmount = currentBet * multiplier;
                balance += winAmount;
                totalWins++;
                totalProfit += winAmount - currentBet;
                
                showResult('ü•â', '–¢–†–ï–¢–¨–ï –ú–ï–°–¢–û!', `–í–∞—à–∞ –º–∞—à–∏–Ω–∞ –∑–∞–Ω—è–ª–∞ 3 –º–µ—Å—Ç–æ!`, `+${winAmount} TON`);
            } else {
                // 4 –º–µ—Å—Ç–æ - –ø—Ä–æ–∏–≥—Ä—ã—à
                totalProfit -= currentBet;
                
                showResult('üí•', '–ü–û–†–ê–ñ–ï–ù–ò–ï!', `–í–∞—à–∞ –º–∞—à–∏–Ω–∞ –∑–∞–Ω—è–ª–∞ 4 –º–µ—Å—Ç–æ...`, `-${currentBet} TON`);
            }
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            saveStats();
            
            // –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É
            document.getElementById('startRace').disabled = false;
            document.getElementById('startRace').innerHTML = 'üèÅ –ù–ê–ß–ê–¢–¨ –ì–û–ù–ö–£';
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∏—Å–ø–ª–µ–π
            updateDisplay();
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            if (multiplier > 0) {
                showNotification(`üéä –í—ã–∏–≥—Ä—ã—à: ${winAmount} TON (√ó${multiplier})`, 'win');
            } else {
                showNotification(`–ü–æ–≤–µ–∑—ë—Ç –≤ —Å–ª–µ–¥—É—é—â–∏–π —Ä–∞–∑!`, 'lose');
            }
        }
        
        // ==================== –ü–û–ö–ê–ó –†–ï–ó–£–õ–¨–¢–ê–¢–ê ====================
        function showResult(icon, title, message, amount) {
            document.getElementById('resultIcon').textContent = icon;
            document.getElementById('resultTitle').textContent = title;
            document.getElementById('resultMessage').textContent = message;
            document.getElementById('resultAmount').textContent = amount;
            document.getElementById('resultOverlay').style.display = 'flex';
        }
        
        function closeResult() {
            document.getElementById('resultOverlay').style.display = 'none';
        }
        
        // ==================== –û–ë–ù–û–í–õ–ï–ù–ò–ï –î–ò–°–ü–õ–ï–Ø ====================
        function updateDisplay() {
            // –ë–∞–ª–∞–Ω—Å
            document.getElementById('balanceAmount').textContent = balance.toLocaleString() + ' TON';
            
            // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
            document.getElementById('gamesPlayed').textContent = gamesPlayed;
            document.getElementById('totalWins').textContent = totalWins;
            
            const winRate = gamesPlayed > 0 ? Math.round((totalWins / gamesPlayed) * 100) : 0;
            document.getElementById('winRate').textContent = winRate + '%';
            
            const profitText = totalProfit >= 0 ? '+' + totalProfit : totalProfit;
            document.getElementById('totalProfit').textContent = profitText + ' TON';
        }
        
        // ==================== –°–¢–ê–¢–ò–°–¢–ò–ö–ê ====================
        function saveStats() {
            const stats = {
                balance,
                gamesPlayed,
                totalWins,
                totalProfit
            };
            localStorage.setItem('racingStats', JSON.stringify(stats));
        }
        
        function loadStats() {
            const saved = JSON.parse(localStorage.getItem('racingStats'));
            if (saved) {
                balance = saved.balance || 1500;
                gamesPlayed = saved.gamesPlayed || 0;
                totalWins = saved.totalWins || 0;
                totalProfit = saved.totalProfit || 0;
            }
        }
        
        function resetGame() {
            if (confirm('–°–±—Ä–æ—Å–∏—Ç—å –≤—Å—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏ –Ω–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ?')) {
                balance = 1500;
                gamesPlayed = 0;
                totalWins = 0;
                totalProfit = 0;
                
                localStorage.removeItem('racingStats');
                updateDisplay();
                showNotification('–ò–≥—Ä–∞ —Å–±—Ä–æ—à–µ–Ω–∞!', 'info');
            }
        }
        
        // ==================== –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø ====================
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.transform = 'translateX(-50%) translateY(0)';
            }, 10);
            
            setTimeout(() => {
                notification.style.transform = 'translateX(-50%) translateY(-100px)';
                setTimeout(() => notification.remove(), 500);
            }, 3000);
        }
    </script>
</body>
</html>
